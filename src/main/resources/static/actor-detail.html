<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ë°°ìš° ìƒì„¸ í˜ì´ì§€</title>

    <style>
        :root{
            --bg:#0b0c0f;
            --panel:#12131a;
            --panel-2:#161824;
            --text:#e7e8ee;
            --muted:#9aa0ad;
            --line:rgba(255,255,255,.08);
            --accent:#7c5cff;
            --accent-2:#24d39a;
            --radius-lg:14px;
            --radius-md:10px;
            --radius-xl:20px;
            --shadow:0 10px 40px rgba(0,0,0,.5);

            --link-blue:#5aa7ff;
            --icon-ring: rgba(255,255,255,.75);
        }

        *{box-sizing:border-box;}
        body{
            margin:0;
            font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;
            color:var(--text);
            background:
                    radial-gradient(900px 400px at 80% 0%, rgba(124,92,255,.2), transparent 60%),
                    radial-gradient(700px 350px at 10% 10%, rgba(36,211,154,.15), transparent 60%),
                    var(--bg);
            min-height:100vh;
            display:flex;
            flex-direction:column;
        }
        .container{
            width:min(1100px,92vw);
            margin:0 auto;
        }

        main.container{ flex: 1; }

        .page-root{
            min-height:100vh;
            display:flex;
            flex-direction:column;
        }
        .page-root > main { flex: 1; }

        header{
            position:sticky; top:0; z-index:10;
            background:rgba(11,12,15,.85);
            backdrop-filter:blur(8px);
            border-bottom:1px solid var(--line);
        }

        .header-row{
            display:flex;
            align-items:center;
            justify-content:space-between;
            height:56px;
        }

        nav ul{
            display:flex; list-style:none; gap:18px;
            padding:0; margin:0;
            font-weight:600; color:var(--muted);
        }
        nav li.active{ color:var(--text); font-weight:700; }

        /* PROFILE SECTION */
        .profile-header{
            margin:30px 0 20px;
            display:flex; gap:28px; align-items:center;
        }
        .profile-photo{
            width:220px; height:300px; border-radius:var(--radius-lg);
            object-fit:cover; border:1px solid var(--line);
            box-shadow:var(--shadow);
        }
        .profile-info h1{
            font-size:34px;
            font-weight:900;
            margin:0 0 10px;
        }
        .profile-info .meta{
            font-size:14px;
            color:var(--muted);
            margin-bottom:8px;
        }
        .bio{
            font-size: 14px;
            color: var(--muted);
            line-height: 1.6;
        }

        .profile-title-row{
            display:flex;
            align-items:center;
            gap:8px;
            position:relative;
        }

        .profile-settings-btn{
            width:28px;
            height:28px;
            border-radius:999px;
            border:1px solid var(--line);
            background:rgba(255,255,255,0.06);
            display:flex;
            align-items:center;
            justify-content:center;
            cursor:pointer;
            font-size:14px;
            padding:0;
            transition:background .15s ease, transform .12s ease, border-color .15s ease;
        }
        .profile-settings-btn:hover{
            background:rgba(124,92,255,0.18);
            border-color:var(--accent);
            transform:translateY(-1px);
        }

        .profile-edit-overlay{
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.82);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: opacity .2s ease;
        }
        .profile-edit-overlay.show{
            opacity: 1;
            pointer-events: auto;
        }
        .profile-edit-card{
            width: min(320px, 90vw);
            background: var(--panel-2);
            border-radius: var(--radius-xl);
            border: 1px solid var(--line);
            box-shadow: 0 20px 60px rgba(0,0,0,.85);
            padding: 14px 16px 10px;
        }
        .profile-edit-card .profile-settings-item{
            padding: 9px 10px;
            font-size: 13px;
        }
        .profile-edit-card .profile-settings-item + .profile-settings-item{
            border-top: 1px solid rgba(255,255,255,0.03);
        }

        .profile-settings-menu{
            position:absolute;
            top:110%;
            right:0;
            min-width:180px;
            background:var(--panel-2);
            border:1px solid var(--line);
            border-radius:var(--radius-md);
            box-shadow:0 12px 40px rgba(0,0,0,.6);
            padding:6px 0;
            display:none;
            z-index:20;
        }
        .profile-settings-menu.show{ display:block; }
        .profile-settings-item{
            width:100%;
            border:none;
            background:transparent;
            color:var(--text);
            text-align:left;
            font-size:13px;
            padding:8px 12px;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:space-between;
        }
        .profile-settings-item span{ pointer-events:none; }
        .profile-settings-item:hover{ background:rgba(124,92,255,0.16); }
        .profile-settings-item.close-item{ color:var(--muted); }

        /* EMPTY CTA */
        .empty-cta{
            margin-top: 14px;
            padding: 42px 0 36px;
            text-align:center;
            user-select:none;
        }
        .empty-cta-icon{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            text-decoration:none;
            outline:none;
        }
        .empty-cta-ring{
            width:72px;
            height:72px;
            border-radius:999px;
            border:2px solid var(--icon-ring);
            display:flex;
            align-items:center;
            justify-content:center;
            background: rgba(255,255,255,0.03);
            transition: transform .14s ease, border-color .14s ease, background .14s ease;
        }
        .empty-cta-icon:hover .empty-cta-ring{
            transform: translateY(-2px);
            border-color: var(--link-blue);
            background: rgba(90,167,255,0.12);
        }

        .empty-cta svg{
            width:30px;
            height:30px;
            stroke: rgba(255,255,255,.92);
            fill: none;
            stroke-width: 1.8;
            transition: stroke .14s ease;
        }
        .empty-cta-icon:hover svg{
            stroke: var(--link-blue);
        }

        .empty-cta-title{
            margin-top: 18px;
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        .empty-cta-desc{
            margin-top: 10px;
            font-size: 13px;
            color: var(--muted);
            line-height: 1.65;
        }
        .empty-cta-link{
            display:inline-block;
            margin-top: 14px;
            font-size: 14px;
            font-weight: 700;
            color: var(--link-blue);
            text-decoration:none;
        }
        .empty-cta-link:hover{
            text-decoration: underline;
        }

        /* âœ… ë¹„ì†Œìœ ì empty: í´ë¦­/í˜¸ë²„ ì—†ëŠ” ì•ˆë‚´ìš© */
        .empty-cta.view-only .empty-cta-icon{
            pointer-events:none;
            cursor:default;
        }
        .empty-cta.view-only .empty-cta-icon:hover .empty-cta-ring{
            transform:none;
            border-color: var(--icon-ring);
            background: rgba(255,255,255,0.03);
        }
        .empty-cta.view-only .empty-cta-link{
            display:none; /* ë¹„ì†Œìœ ìëŠ” ë§í¬ ìˆ¨ê¹€ */
        }


        /* FILMOGRAPHY */
        .filmography-section h2{
            font-size:22px; font-weight:900; margin:40px 0 14px;
        }

        .film-slider-container{
            position:relative;
            margin-top:20px;
        }

        .film-slider-wrapper{
            position: relative;
            overflow:hidden;
        }

        .film-slider{
            display:flex;
            gap:20px;
            transition:transform .4s ease;
        }

        .film-card{
            flex: 0 0 32%;
            max-width: 32%;
            background:var(--panel);
            border:1px solid var(--line);
            border-radius:var(--radius-lg);
            overflow:hidden;
            cursor:pointer;
            transition:.15s;
        }
        .film-card:hover{
            transform:scale(1.015);
            border-color:var(--accent);
        }

        .film-poster{
            width:100%;
            aspect-ratio:16/9;
            object-fit:cover;
        }
        .film-body{ padding:12px; }
        .film-title{ font-size:16px; font-weight:900; }
        .film-meta{ margin-top:6px; font-size:13px; color:var(--muted); }

        .film-arrow{
            position:absolute;
            top:50%;
            transform:translateY(-50%);
            border:none;
            background:transparent;
            color:white;
            font-size:48px;
            font-weight:300;
            cursor:pointer;
            display: none;
            transition:opacity .3s ease;
            z-index:10;
            padding:0 8px;
        }
        .film-slider-container:hover .film-arrow{ opacity:1; }
        .film-arrow.left{ left:-100px; }
        .film-arrow.right{ right:-100px; }
        .film-arrow:hover{
            color:var(--accent);
            transform:translateY(-50%) scale(1.1);
        }

        /* MOVIE POPUP */
        .movie-popup {
            position: fixed;
            z-index: 999;
            background: var(--panel-2);
            border-radius: 14px;
            border: 1px solid var(--line);
            box-shadow: 0 25px 70px rgba(0,0,0,.85);
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
            transform-origin: center center;
            transition:
                    opacity .18s ease-out,
                    transform .22s cubic-bezier(.24,.82,.24,1.4);
        }

        .movie-popup.show{
            opacity:1;
            pointer-events:auto;
            transform:scale(1) translateY(0);
            filter:brightness(1);
        }

        .popup-video-box {
            position: relative;
            width: 100%;
            height: 60%;
            background: black;
            overflow: hidden;
        }

        .popup-video-box video{
            position:absolute;
            inset:0;
            width:100%;
            height:100%;
            object-fit:cover;
            z-index:0;
        }

        .popup-video-box .popup-thumb{
            position:absolute;
            inset:0;
            width:100%;
            height:100%;
            object-fit:cover;
            z-index:1;
            transition: opacity .2s ease;
            opacity:1;
            display:block;
        }

        .popup-info{ padding: 14px 16px; }
        .popup-title{
            font-size:20px;
            font-weight:900;
            margin-bottom:6px;
            line-height: 1.25;
        }
        .popup-meta{
            font-size:13px;
            font-weight:500;
            color:var(--muted);
            margin-bottom:10px;
            display:flex;
            align-items:center;
            gap:6px;
        }
        .popup-age{
            background:rgba(255,0,0,.85);
            padding:4px 8px;
            border-radius:6px;
            font-size:12px;
            font-weight:800;
            color:white;
        }

        .popup-action-row {
            margin-top: 6px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .popup-mute-btn{
            position:absolute;
            bottom:10px;
            right:10px;
            width:42px;
            height:42px;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            background:rgba(0,0,0,.55);
            backdrop-filter:blur(6px);
            border:1px solid rgba(255,255,255,.35);
            color:white;
            font-size:20px;
            cursor:pointer;
            transition:background .2s ease, transform .2s ease;
        }
        .popup-mute-btn:hover{
            background:rgba(255,255,255,.25);
            transform:scale(1.12);
        }

        .popup-play-btn-circle,
        .popup-like-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 900;
            cursor: pointer;
            transition:
                    background .2s,
                    transform .2s cubic-bezier(.2,1.7,.6,1);
        }
        .popup-play-btn-circle{
            background: rgba(255,255,255,0.9);
            color: black;
        }
        .popup-play-btn-circle:hover {
            background: white;
            transform: scale(1.08);
        }

        .popup-like-btn {
            background: rgba(255,255,255,0.2);
            color: var(--text);
        }
        .popup-like-btn.liked {
            background: rgba(124,92,255,0.9);
            color: white;
            transform: scale(1.15);
        }
        .popup-like-btn:active { transform: scale(0.92); }

        /* GALLERY */
        .gallery-section h2{
            font-size:22px;
            font-weight:900;
            margin:40px 0 14px;
        }
        .gallery-grid{
            display:grid;
            grid-template-columns:repeat(3,1fr);
            gap:12px;
        }
        /* gallery-grid ì•ˆì— ìˆëŠ” empty-ctaëŠ” ì „ë¶€ í•œ ì¤„(ì „ì²´í­) */
        .gallery-grid > .empty-cta{
            grid-column: 1 / -1;
        }
        .gallery-item{
            width:100%;
            aspect-ratio:4/5;
            border-radius:var(--radius-lg);
            object-fit:cover;
            background:#0f1117;
            border:1px solid var(--line);
            transition: filter .18s ease, box-shadow .18s ease;
            outline: none;
        }

        .gallery-item:hover{
            filter: brightness(0.6);
            box-shadow: 0 6px 16px rgba(0,0,0,.55);
            border-color: var(--line);
        }
        .gallery-item:focus { outline: none; }

        .gallery-spinner{
            width: 40px;
            height: 40px;
            margin: 20px auto 0;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .spinner-circle{
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 3px solid var(--muted);
            border-top-color: var(--accent);
            animation: gallery-spin .8s linear infinite;
        }
        @keyframes gallery-spin { to { transform: rotate(360deg); } }

        .gallery-lightbox-overlay{
            position:fixed;
            inset:0;
            background:rgba(0,0,0,.88);
            display:flex;
            align-items:center;
            justify-content:center;
            z-index:9999;
            opacity:0;
            pointer-events:none;
            transition:opacity .2s ease;
        }

        .gallery-lightbox-overlay.show{
            opacity:1;
            pointer-events:auto;
        }

        .gallery-lightbox-image{
            max-width:90vw;
            max-height:90vh;
            border-radius:var(--radius-lg);
            border:1px solid var(--line);
            box-shadow:0 18px 60px rgba(0,0,0,.9);
            display:block;
            cursor:zoom-out;
        }

        .gallery-lightbox-arrow{
            position:absolute;
            top:50%;
            transform:translateY(-50%);
            border:none;
            background:transparent;
            color:white;
            font-size:48px;
            font-weight:300;
            cursor:pointer;
            padding:0 12px;
            display:flex;
            align-items:center;
            justify-content:center;
            transition:opacity .3s ease, transform .2s ease, color .2s ease;
        }

        .gallery-lightbox-arrow.left{ left:40px; }
        .gallery-lightbox-arrow.right{ right:40px; }
        .gallery-lightbox-arrow:hover{
            color:var(--accent);
            transform:translateY(-50%) scale(1.1);
        }

        footer{
            margin-top:auto;
            padding:24px 0 30px;
            border-top:1px solid var(--line);
            text-align:center;
            font-size:12px;
            color:var(--muted);
        }

        .sns-row{
            margin-top: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            min-height: 34px;
        }

        .sns-row.is-empty::before {
            content:"SNSë¥¼ ì¶”ê°€í•˜ë©´ ìºìŠ¤íŒ… ë‹´ë‹¹ìê°€ ë” ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.";
            color:var(--muted);
            font-size:13px;
        }

        .sns-pill{
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(255,255,255,0.06);
            border: 1px solid var(--line);
            font-size: 13px;
            color: var(--text);
            text-decoration: none;
        }
        .sns-pill:hover{ background: rgba(124,92,255,0.18); }

        .sns-handle{ color: var(--muted); font-size: 12px; }

        .sns-badge{
            width:22px;
            height:22px;
            border-radius:999px;
            display:inline-flex;
            align-items:center;
            justify-content:center;
            flex:0 0 auto;
        }

        .sns-icon{
            width:14px;
            height:14px;
            background:#fff;
            -webkit-mask: var(--sns-mask) center/contain no-repeat;
            mask: var(--sns-mask) center/contain no-repeat;
        }

        .sns-pill[data-brand="instagram"] .sns-badge{
            background: radial-gradient(circle at 30% 110%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
        }
        .sns-pill[data-brand="instagram"] .sns-icon{ --sns-mask: url("https://cdn.jsdelivr.net/npm/simple-icons/icons/instagram.svg"); }
        .sns-pill[data-brand="youtube"] .sns-badge{ background:#FF0000; }
        .sns-pill[data-brand="youtube"] .sns-icon{ --sns-mask: url("https://cdn.jsdelivr.net/npm/simple-icons/icons/youtube.svg"); }
        .sns-pill[data-brand="naver"] .sns-badge{ background:#03C75A; }
        .sns-pill[data-brand="naver"] .sns-icon{ --sns-mask: url("https://cdn.jsdelivr.net/npm/simple-icons/icons/naver.svg"); }
        .sns-pill[data-brand="x"] .sns-badge{ background:#FFFFFF; }
        .sns-pill[data-brand="x"] .sns-icon{
            background:#000;
            --sns-mask: url("https://cdn.jsdelivr.net/npm/simple-icons/icons/x.svg");
        }

        .profile-tag-section{ margin-top: 14px; }
        .profile-tag-title{
            font-size: 12px;
            font-weight: 700;
            letter-spacing: .08em;
            text-transform: uppercase;
            color: var(--muted);
            margin-bottom: 6px;
        }

        .profile-tag-list{
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            min-height:28px;
        }
        .profile-tag-list.is-empty::before{
            content:"íƒœê·¸ë¥¼ ì¶”ê°€í•´ ê°•ì ì„ ë³´ì—¬ì£¼ì„¸ìš”. (ì˜ˆ: #ì£¼ì—° #ë“œë¼ë§ˆ)";
            color:var(--muted);
            font-size:13px;
        }

        .profile-tag{
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(124,92,255,0.14);
            border: 1px solid rgba(124,92,255,0.4);
            color: var(--text);
        }

        .logo{
            font-weight:800;
            font-size:18px;
            color:var(--text);
            text-decoration:none;
        }

        .login-btn{
            padding:6px 14px;
            font-size:13px;
            border-radius:999px;
            border:1px solid var(--line);
            background:rgba(255,255,255,0.06);
            color:var(--text);
            cursor:pointer;
            font-weight:600;
            transition:background .15s ease, border-color .15s ease, transform .12s ease;
        }
        .login-btn:hover{
            background:rgba(124,92,255,0.22);
            border-color:var(--accent);
            transform:translateY(-1px);
        }

        /* ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ */
        .login-overlay{
            position:fixed;
            inset:0;
            background:rgba(0,0,0,.78);
            display:flex;
            align-items:center;
            justify-content:center;
            z-index:11000;
            opacity:0;
            pointer-events:none;
            transition:opacity .2s ease;
        }
        .login-overlay.show{
            opacity:1;
            pointer-events:auto;
        }

        .login-card{
            width:min(360px,92vw);
            background:var(--panel-2);
            border-radius:var(--radius-xl);
            border:1px solid var(--line);
            box-shadow:0 20px 60px rgba(0,0,0,.9);
            padding:20px 22px 18px;
        }

        .login-brand{
            font-size:20px;
            font-weight:800;
            text-align:center;
            margin-bottom:18px;
        }

        .login-label{
            display:block;
            font-size:13px;
            font-weight:600;
            color:var(--muted);
            margin:8px 0 6px;
        }

        .login-input{
            width:100%;
            padding:8px 10px;
            border-radius:10px;
            border:1px solid var(--line);
            background:rgba(0,0,0,.25);
            color:var(--text);
            font-size:13px;
            outline:none;
            transition:border-color .15s ease, background .15s ease;
        }
        .login-input::placeholder{ color:rgba(154,160,173,.7); }
        .login-input:focus{
            border-color:var(--accent);
            background:rgba(15,16,25,.95);
        }

        .login-submit-btn{
            margin-top:14px;
            width:100%;
            padding:9px 0;
            border-radius:999px;
            border:none;
            background:var(--accent);
            color:#fff;
            font-size:14px;
            font-weight:700;
            cursor:pointer;
            transition:background .15s ease, transform .12s ease;
        }
        .login-submit-btn:hover{
            background:#8a6dff;
            transform:translateY(-1px);
        }

        .login-divider{
            display:flex;
            align-items:center;
            gap:8px;
            margin:18px 0 12px;
            font-size:11px;
            color:var(--muted);
        }
        .login-divider-line{
            flex:1;
            height:1px;
            background:rgba(255,255,255,.14);
        }

        .social-row{
            display:flex;
            flex-direction:column;
            gap:8px;
        }
        .social-btn{
            width:100%;
            padding:8px 10px;
            border-radius:999px;
            border:none;
            font-size:13px;
            font-weight:600;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            gap:6px;
            transition:transform .12s ease, box-shadow .12s ease, background .15s ease;
        }
        .social-btn:hover{
            transform:translateY(-1px);
            box-shadow:0 6px 18px rgba(0,0,0,.55);
        }
        .social-google{ background:#ffffff; color:#111111; }
        .social-naver{ background:#03c75a; color:#ffffff; }

        .login-links{
            margin-top:8px;
            font-size:11px;
            display:flex;
            justify-content:center;
            align-items:center;
            gap:10px;
            color:var(--muted);
        }

        .login-links a{
            color:var(--muted);
            text-decoration:none;
        }
        .login-links a:hover{
            color:var(--text);
            text-decoration:underline;
        }

        html{
            scrollbar-gutter: stable;
            height: 100%;
        }

        .hidden{ display:none !important; }

        .profile-header.is-empty{ align-items:flex-start; }
        .profile-header.is-empty .profile-photo{
            filter:saturate(.9) brightness(.95);
            opacity:.92;
        }

        /* âœ… ê°¤ëŸ¬ë¦¬ emptyê°€ grid ì „ì²´ë¥¼ ì°¨ì§€í•˜ë„ë¡ ìœ ì§€ */
        #galleryGrid #galleryEmpty{ grid-column: 1 / -1; }

        /* ===== í—¤ë” ì˜¤ë¥¸ìª½ ì˜ì—­ & í”„ë¡œí•„ ë©”ë‰´ (index.htmlê³¼ ë™ì¼) ===== */
        .header-right{
            display:flex;
            align-items:center;
            gap:10px;
        }
        .header-nav-links{
            display:flex;
            align-items:center;
            gap:8px;
        }

        .profile-menu{ position:relative; }

        .profile-avatar-btn{
            width:32px;
            height:32px;
            border-radius:999px;
            border:1px solid var(--line);
            padding:0;
            background:rgba(255,255,255,0.04);
            cursor:pointer;
            display:inline-flex;
            align-items:center;
            justify-content:center;
            overflow:hidden;
            transition:transform .12s ease,border-color .12s ease,box-shadow .12s ease;
        }
        .profile-avatar-btn:hover{
            transform:translateY(-1px);
            border-color:var(--accent);
            box-shadow:0 6px 18px rgba(0,0,0,.6);
        }
        .profile-avatar-btn img{
            width:100%;
            height:100%;
            object-fit:cover;
        }
        .profile-avatar-initial{
            font-size:13px;
            font-weight:700;
            color:var(--text);
        }

        .profile-dropdown{
            position:absolute;
            top:120%;
            right:0;
            min-width:210px; /* âœ… indexì™€ ë™ì¼ */
            background:var(--panel-2);
            border-radius:12px;
            border:1px solid var(--line);
            box-shadow:0 14px 40px rgba(0,0,0,.9);
            padding:6px 0;
            opacity:0;
            pointer-events:none;
            transform:translateY(-6px);
            transition:opacity .16s ease, transform .16s ease;
            z-index:9999;
        }
        .profile-dropdown.open{
            opacity:1;
            pointer-events:auto;
            transform:translateY(0);
        }

        .profile-group-title{
            padding:8px 12px 6px;
            font-size:11px;
            color:var(--muted);
            letter-spacing:.12em;
            text-transform:uppercase;
        }
        .profile-divider{
            height:1px;
            margin:6px 0;
            background:rgba(255,255,255,.08);
        }

        .profile-item{
            width:100%;
            padding:8px 12px;
            text-align:left;
            background:transparent;
            border:none;
            color:var(--text);
            font-size:13px;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:10px; /* âœ… indexì™€ ë™ì¼ */
        }
        .profile-item span{
            font-size:11px;
            color:var(--muted);
        }
        .profile-item:hover{
            background:rgba(255,255,255,0.06);
        }




        /* âœ… owner-only: â€œìˆ¨ê¹€ì´ì§€ë§Œ ê³µê°„ ìœ ì§€â€ (í•„ëª¨/ê°¤ëŸ¬ë¦¬ ì˜ì—­ êµ¬ì¡° ìœ ì§€ìš©) */
        .owner-only.hidden-keep-space{
            visibility:hidden;
            pointer-events:none;
        }
    </style>
</head>

<body>
<div class="page-root">
    <header>
        <div class="container header-row">
            <a href="/index.html" class="logo">OnFilm</a>
            <div class="header-right" id="headerActions"></div>
        </div>
    </header>

    <main class="container">

        <!-- PROFILE -->
        <div class="profile-header">
            <img id="profilePhoto"
                 class="profile-photo"
                 src="/videos/profile-placeholder.png"
                 data-profile-src=""
                 alt="í”„ë¡œí•„ ì‚¬ì§„" />

            <div class="profile-info">
                <div class="profile-title-row">
                    <h1 id="profileName" data-value="">íšŒì›</h1>
                    <button type="button"
                            class="profile-settings-btn"
                            id="profileSettingsBtn"
                            aria-haspopup="true"
                            aria-expanded="false"
                            title="í¸ì§‘ ë©”ë‰´ ì—´ê¸°">âš™ï¸</button>
                </div>

                <div class="meta" id="profileMeta" data-birth-date="" data-birth-place="">
                    ìƒë…„ì›”ì¼ Â· ì¶œìƒì§€ ë¯¸ë“±ë¡
                </div>

                <p class="bio" id="bioDisplay" data-value="">
                    ì†Œê°œê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.
                </p>

                <div class="sns-row" id="snsRow"></div>

                <section class="profile-tag-section">
                    <div class="profile-tag-title">PROFILE TAGS</div>
                    <div class="profile-tag-list" id="tagList"></div>
                </section>
            </div>
        </div>

        <!-- FILMOGRAPHY -->
        <section class="filmography-section" id="filmographySection">
            <h2>í•„ëª¨ê·¸ë˜í”¼</h2>

            <div class="film-slider-container" id="filmSliderContainer">

                <!-- âœ… owner-only: ì†Œìœ ìë§Œ ë“±ë¡ CTA ë³´ì„ -->
                <div class="empty-cta hidden owner-only" id="filmEmpty">
                    <a class="empty-cta-icon" href="/edit-filmography.html" aria-label="í•„ëª¨ê·¸ë˜í”¼ ë“±ë¡í•˜ê¸°">
                        <span class="empty-cta-ring">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6.5h16v11H4z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 6.5v11M16 6.5v11"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6.2 8.2h.01M6.2 10.2h.01M6.2 12.2h.01M6.2 14.2h.01"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.8 8.2h.01M17.8 10.2h.01M17.8 12.2h.01M17.8 14.2h.01"/>
                          </svg>
                        </span>
                    </a>

                    <div class="empty-cta-title">í•„ëª¨ê·¸ë˜í”¼ ê³µìœ </div>
                    <div class="empty-cta-desc">ì‘í’ˆì„ ë“±ë¡í•˜ë©´ íšŒì›ë‹˜ì˜ í”„ë¡œí•„ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                    <a class="empty-cta-link" href="/edit-filmography.html">ì²« ì‘í’ˆ ë“±ë¡í•˜ê¸°</a>
                </div>

                <!-- âœ… view-only: ë¹„ì†Œìœ ì/ë¹„ë¡œê·¸ì¸ + ê²Œì‹œë¬¼ ì—†ìŒ -->
                <div class="empty-cta hidden view-only" id="filmEmptyViewOnly">
                    <a class="empty-cta-icon" href="javascript:void(0)" aria-label="í•„ëª¨ê·¸ë˜í”¼ ê²Œì‹œë¬¼ ì—†ìŒ">
                        <span class="empty-cta-ring">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6.5h16v11H4z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 6.5v11M16 6.5v11"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6.2 8.2h.01M6.2 10.2h.01M6.2 12.2h.01M6.2 14.2h.01"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.8 8.2h.01M17.8 10.2h.01M17.8 12.2h.01M17.8 14.2h.01"/>
                          </svg>
                        </span>
                    </a>

                    <div class="empty-cta-title">ê²Œì‹œë¬¼ ì—†ìŒ</div>
                </div>


                <button class="film-arrow left" id="filmPrevBtn">â€¹</button>

                <div class="film-slider-wrapper">
                    <div class="film-slider" id="filmSlider"></div>
                </div>

                <button class="film-arrow right" id="filmNextBtn">â€º</button>
            </div>
        </section>

        <!-- GALLERY -->
        <section class="gallery-section" id="gallerySection">
            <h2>ì‚¬ì§„ ê°¤ëŸ¬ë¦¬</h2>
            <div class="gallery-grid" id="galleryGrid">

                <!-- âœ… owner-only: ì†Œìœ ìë§Œ ë“±ë¡ CTA ë³´ì„ -->
                <div class="empty-cta hidden owner-only" id="galleryEmpty">
                    <a class="empty-cta-icon" href="/edit-gallery.html" aria-label="ì‚¬ì§„ ê³µìœ í•˜ê¸°">
                        <span class="empty-cta-ring">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M7 7.5h2l1-1.5h4l1 1.5h2A3 3 0 0 1 20 10.5v7A3 3 0 0 1 17 20.5H7A3 3 0 0 1 4 17.5v-7A3 3 0 0 1 7 7.5Z"/>
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M12 11a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 7.5l.9-1.2"/>
                          </svg>
                        </span>
                    </a>

                    <div class="empty-cta-title">ì‚¬ì§„ ê³µìœ </div>
                    <div class="empty-cta-desc">ì‚¬ì§„ì„ ê³µìœ í•˜ë©´ íšŒì›ë‹˜ì˜ í”„ë¡œí•„ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                    <a class="empty-cta-link" href="/edit-gallery.html">ì²« ì‚¬ì§„ ë“±ë¡í•˜ê¸°</a>
                </div>

                <!-- âœ… view-only: ë¹„ì†Œìœ ì/ë¹„ë¡œê·¸ì¸ + ê²Œì‹œë¬¼ ì—†ìŒ -->
                <div class="empty-cta hidden view-only" id="galleryEmptyViewOnly">
                    <a class="empty-cta-icon" href="javascript:void(0)" aria-label="ê°¤ëŸ¬ë¦¬ ê²Œì‹œë¬¼ ì—†ìŒ">
                        <span class="empty-cta-ring">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M7 7.5h2l1-1.5h4l1 1.5h2A3 3 0 0 1 20 10.5v7A3 3 0 0 1 17 20.5H7A3 3 0 0 1 4 17.5v-7A3 3 0 0 1 7 7.5Z"/>
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M12 11a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 7.5l.9-1.2"/>
                          </svg>
                        </span>
                    </a>

                    <div class="empty-cta-title">ê²Œì‹œë¬¼ ì—†ìŒ</div>
                </div>


                <!-- gallery-itemë“¤ì€ ì‹¤ì œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì—¬ê¸°ì— ë“¤ì–´ì˜´ -->
            </div>

            <div class="gallery-spinner" id="gallerySpinner">
                <div class="spinner-circle"></div>
            </div>
        </section>
    </main>

    <footer>Â© 2025 OnFilm Â· Indie Actor & Film Platform</footer>
</div>

<!-- í”„ë¡œí•„ í¸ì§‘ ì˜¤ë²„ë ˆì´ -->
<div class="profile-edit-overlay" id="profileEditOverlay">
    <div class="profile-edit-card">
        <button class="profile-settings-item" data-action="profile"><span>í”„ë¡œí•„ í¸ì§‘</span></button>
        <button class="profile-settings-item" data-action="filmography"><span>í•„ëª¨ê·¸ë˜í”¼ í¸ì§‘</span></button>
        <button class="profile-settings-item" data-action="gallery"><span>ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ í¸ì§‘</span></button>
        <button class="profile-settings-item close-item" data-action="close"><span>ì°½ ë‹«ê¸°</span></button>
    </div>
</div>

<!-- ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ -->
<div class="login-overlay" id="loginOverlay">
    <div class="login-card">
        <div class="login-brand">OnFilm</div>

        <label class="login-label" for="loginEmail">ì•„ì´ë””</label>
        <input id="loginEmail" class="login-input" type="email" placeholder="name@example.com" />

        <label class="login-label" for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
        <input id="loginPassword" class="login-input" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />

        <button class="login-submit-btn" id="loginSubmitBtn" type="button">ë¡œê·¸ì¸</button>

        <div class="login-links">
            <a href="signup.html">íšŒì›ê°€ì…</a>
            <span>â”‚</span>
            <a href="find-id.html">ì•„ì´ë”” ì°¾ê¸°</a>
            <span>â”‚</span>
            <a href="find-password.html">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
        </div>

        <div class="login-divider">
            <span class="login-divider-line"></span>
            <span>ë˜ëŠ”</span>
            <span class="login-divider-line"></span>
        </div>

        <div class="social-row">
            <button type="button" class="social-btn social-google">Googleë¡œ ê³„ì†í•˜ê¸°</button>
            <button type="button" class="social-btn social-naver">ë„¤ì´ë²„ë¡œ ê³„ì†í•˜ê¸°</button>
        </div>
    </div>
</div>

<script src="/js/auth.js"></script>

<script>let popup = null;</script>

<!-- JS 1: FILMOGRAPHY SLIDER -->
<script>
    const slider   = document.getElementById("filmSlider");
    const prevBtn  = document.getElementById("filmPrevBtn");
    const nextBtn  = document.getElementById("filmNextBtn");
    const filmLine = document.querySelector(".film-slider-container");

    let index = 0;

    function getCardWidth(){
        const card = slider.children[0];
        if (!card) return 0;
        const style = window.getComputedStyle(card);
        const marginRight = parseInt(style.marginRight) || 0;
        return card.offsetWidth + marginRight + 20;
    }

    function updateArrows() {
        const cardCount = slider.children.length;
        const maxIndex = cardCount - 3;

        if (cardCount <= 3) {
            prevBtn.style.display = "none";
            nextBtn.style.display = "none";
            return;
        }

        prevBtn.style.display = (index === 0) ? "none" : "flex";
        nextBtn.style.display = (index >= maxIndex) ? "none" : "flex";
    }

    function updateSlider(){
        const w = getCardWidth();
        slider.style.transform = `translateX(${-w * index}px)`;
        updateArrows();
    }

    nextBtn.addEventListener("click", () => {
        const maxIndex = slider.children.length - 3;
        if(index < maxIndex){
            index++;
            updateSlider();
        }
    });

    prevBtn.addEventListener("click", () => {
        if(index > 0){
            index--;
            updateSlider();
        }
    });

    window.addEventListener("mousemove", (e) => {
        if (!filmLine) return;
        const rect = filmLine.getBoundingClientRect();
        const y = e.clientY;

        const inFilmLine = y >= rect.top && y <= rect.bottom;

        if (inFilmLine) {
            updateArrows();
        } else {
            if (!popup || !popup.classList.contains("show")) {
                prevBtn.style.display = "none";
                nextBtn.style.display = "none";
            }
        }
    });
</script>

<!-- JS 2: MOVIE POPUP -->
<script>
    let hideTimer = null;
    let activeCard = null;

    function createPopup() {
        popup = document.createElement("div");
        popup.className = "movie-popup";

        popup.innerHTML = `
      <div class="popup-video-box">
        <img class="popup-thumb" />
        <video muted loop playsinline></video>

        <div class="popup-mute-btn">
          <svg class="popup-sound-on" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            width="26" height="26" style="display:none;">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25
              l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51
              c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396
              C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"/>
          </svg>

          <svg class="popup-sound-off" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            width="26" height="26">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l2.25 2.25m-10.5-6
              4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51
              c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396
              C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"/>
          </svg>
        </div>
      </div>

      <div class="popup-info">
        <div class="popup-title"></div>
        <div class="popup-meta"></div>

        <div class="popup-action-row">
          <button class="popup-play-btn-circle"><span>â–¶</span></button>
          <button class="popup-like-btn"><span>ğŸ‘</span></button>
        </div>
      </div>
    `;

        document.body.appendChild(popup);

        popup.addEventListener("mouseenter", () => {
            if (hideTimer) clearTimeout(hideTimer);
        });

        popup.addEventListener("mouseleave", hidePopup);

        popup.querySelector(".popup-mute-btn").onclick = (e) => {
            e.stopPropagation();
            const v = popup.querySelector("video");
            const soundOn = popup.querySelector(".popup-sound-on");
            const soundOff = popup.querySelector(".popup-sound-off");

            v.muted = !v.muted;

            if (v.muted) {
                soundOn.style.display = "none";
                soundOff.style.display = "block";
            } else {
                soundOn.style.display = "block";
                soundOff.style.display = "none";
            }
        };

        popup.querySelector(".popup-play-btn-circle").onclick = (e) => {
            e.stopPropagation();
            sessionStorage.setItem("allowSoundPlay", "true");
            window.location.href = "/video-player-temp.html";
        };

        const likeBtn = popup.querySelector(".popup-like-btn");
        likeBtn.onclick = (e) => {
            e.stopPropagation();
            likeBtn.classList.toggle("liked");

            if (likeBtn.classList.contains("liked")) {
                likeBtn.style.transform = "scale(1.25)";
                setTimeout(() => { likeBtn.style.transform = "scale(1)"; }, 250);
            }
        };

        popup.addEventListener("click", () => {
            window.location.href = "/movie-detail.html";
        });
    }
    createPopup();

    function showPopup(card){
        if (!popup) return;

        if (hideTimer) clearTimeout(hideTimer);
        activeCard = card;

        updateArrows();

        const rect    = card.getBoundingClientRect();
        const videoEl = popup.querySelector("video");
        const thumbEl = popup.querySelector(".popup-thumb");

        popup.querySelector(".popup-title").textContent = card.dataset.title ?? "";
        popup.querySelector(".popup-meta").innerHTML = `
      ${card.dataset.genre ?? ""} Â· ${card.dataset.runtime ?? ""}
      <span class="popup-age">${card.dataset.age ?? ""}</span>
    `;

        const thumb = card.dataset.thumb;
        if (thumb) {
            thumbEl.src = thumb;
            thumbEl.style.display = "block";
            thumbEl.style.opacity = "1";
        } else {
            thumbEl.style.display = "none";
        }

        videoEl.pause();
        videoEl.src = card.dataset.video;
        videoEl.currentTime = 0;

        const onTimeUpdate = () => {
            if (videoEl.currentTime >= 0.15) {
                thumbEl.style.opacity = "0";
                videoEl.removeEventListener("timeupdate", onTimeUpdate);
            }
        };
        videoEl.addEventListener("timeupdate", onTimeUpdate);

        videoEl.play().catch(() => {});

        const EXTRA_INFO_HEIGHT = 60;
        popup.style.width  = rect.width + "px";
        popup.style.height = (rect.height + EXTRA_INFO_HEIGHT) + "px";
        popup.style.left   = rect.left + "px";
        popup.style.top    = (rect.top - EXTRA_INFO_HEIGHT * 0.4) + "px";

        popup.style.opacity   = "0";
        popup.style.transform = "scale(0.9)";
        popup.classList.add("show");

        requestAnimationFrame(() => {
            popup.style.opacity   = "1";
            popup.style.transform = "scale(1.3) translateY(-6px)";
        });
    }

    function hidePopup(){
        hideTimer = setTimeout(() => {
            const videoEl = popup.querySelector("video");
            const thumbEl = popup.querySelector(".popup-thumb");

            popup.style.opacity = "0";
            popup.style.transform = "scale(0.85) translateY(10px)";

            videoEl.pause();
            if (thumbEl) thumbEl.style.opacity = "1";

            setTimeout(() => popup.classList.remove("show"), 180);
            activeCard = null;
        }, 120);
    }

    const filmSliderEl = document.getElementById("filmSlider");

    if (filmSliderEl) {
        filmSliderEl.addEventListener("mouseover", (e) => {
            const card = e.target.closest(".film-card");
            if (!card || !filmSliderEl.contains(card)) return;
            if (activeCard === card) return;
            showPopup(card);
        });

        filmSliderEl.addEventListener("mouseout", (e) => {
            const fromCard = e.target.closest(".film-card");
            if (!fromCard) return;

            const toEl = e.relatedTarget;
            if (toEl && fromCard.contains(toEl)) return;

            hidePopup();
        });
    }

    function hidePopupImmediate() {
        if (!popup) return;
        popup.style.opacity = "0";
        popup.style.transform = "scale(0.85) translateY(10px)";
        popup.querySelector("video").pause();
        popup.classList.remove("show");
        activeCard = null;
        if (hideTimer) clearTimeout(hideTimer);
    }

    window.addEventListener("wheel", () => { if (activeCard) hidePopupImmediate(); });
    window.addEventListener("scroll", () => { if (activeCard) hidePopupImmediate(); });
    window.addEventListener("touchmove", () => { if (activeCard) hidePopupImmediate(); });

    window.addEventListener("load", updateArrows);
</script>

<!-- âœ… ê¶Œí•œ/ì†Œìœ ì íŒë³„ í—¬í¼ (ID ê¸°ë°˜) -->
<script>
    // í˜„ì¬ í”„ë¡œí•„ í˜ì´ì§€ì˜ usernameì„ ê²½ë¡œì—ì„œ ì¶”ì¶œ (/onfilm/{username})
    function getUsernameFromPath() {
        const parts = window.location.pathname.split("/").filter(Boolean);
        if (parts.length >= 2 && parts[0] === "onfilm") return decodeURIComponent(parts[1]);
        return null;
    }

    // ì„œë²„ì—ì„œ person(í”„ë¡œí•„ ì£¼ì¸) ì¡°íšŒ (ë°˜ë“œì‹œ id í¬í•¨í•˜ë„ë¡)
    async function fetchPersonByName(username) {
        const res = await fetch(`/persons/${encodeURIComponent(username)}`, {
            method: "GET",
            headers: { "Accept": "application/json" }
        });
        if (!res.ok) throw new Error("GET_PERSON_FAILED status=" + res.status);
        return await res.json();
    }

    // ì„¸ì…˜ ë³µêµ¬í•´ì„œ me ê°€ì ¸ì˜¤ê¸°
    async function restoreMeSafe() {
        try {
            const result = await window.OnfilmAuth.restoreSession();
            console.log("restoreSession result:", result);
            console.log("me.id =", result?.me?.id);
            if (result && result.ok && result.me) return result.me;
        } catch (e) {}
        return null;
    }

    // ID ê¸°ë°˜ ì†Œìœ ì íŒë³„:
    // - me.id === person.id (or person.ownerId)
    function computeIsOwnerById(me, person) {
        const myId = me?.id;
        if (myId === null || myId === undefined) return false;

        // ë°±ì—”ë“œê°€ person.id ë¡œ ì£¼ëŠ” ê²½ìš°
        const personId = person?.id;

        // í˜¹ì‹œ ownerId ë¡œ ì£¼ëŠ” ê²½ìš°ê¹Œì§€ ëŒ€ë¹„ (ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ìˆì–´ë„ ë¨)
        const ownerId = person?.ownerId;

        return (personId !== undefined && personId !== null && String(myId) === String(personId))
            || (ownerId !== undefined && ownerId !== null && String(myId) === String(ownerId));
    }

    // isOwnerì— ë”°ë¼ í¸ì§‘ UI í† ê¸€
    function applyOwnerUI(isOwner){
        // âš™ï¸ / í¸ì§‘ ì˜¤ë²„ë ˆì´ëŠ” ì™„ì „ ìˆ¨ê¹€
        document.getElementById("profileSettingsBtn")?.classList.toggle("hidden", !isOwner);
        document.getElementById("profileEditOverlay")?.classList.toggle("hidden", !isOwner);

        // í•„ëª¨/ê°¤ëŸ¬ë¦¬ empty CTAëŠ” "êµ¬ì¡° ìœ ì§€" ìœ„í•´ ë¹„ì†Œìœ ìë©´ ê³µê°„ë§Œ ë‚¨ê¸°ê¸°(visibility hidden)
        const ownerCtas = document.querySelectorAll(".owner-only");
        ownerCtas.forEach(el => {
            el.classList.remove("hidden-keep-space");
            if (!isOwner) el.classList.add("hidden-keep-space");
        });

        // ì „ì—­ ìƒíƒœ ì €ì¥(ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ í™œìš©)
        window.__isOwner = !!isOwner;
    }
</script>

<!-- JS 3: GALLERY + LIGHTBOX + í¸ì§‘ ë©”ë‰´ JS -->
<script>
    const gallerySection = document.querySelector(".gallery-section");
    const galleryGrid    = document.querySelector(".gallery-grid");
    const galleryItems   = Array.from(galleryGrid.querySelectorAll(".gallery-item"));
    const gallerySpinner = document.getElementById("gallerySpinner");

    const INITIAL_COUNT = 6;
    const BATCH_SIZE    = 6;

    let visibleCount = 0;
    let isLoading    = false;

    let lightboxOverlay = null;
    let lightboxImg     = null;
    let currentIndex    = 0;

    function initGallery() {
        galleryItems.forEach((img, idx) => {
            img.style.display = (idx < INITIAL_COUNT) ? "block" : "none";
        });
        visibleCount = Math.min(INITIAL_COUNT, galleryItems.length);

        if (galleryItems.length <= INITIAL_COUNT && gallerySpinner) {
            gallerySpinner.style.display = "none";
        }
    }

    function showMoreImages() {
        const remaining = galleryItems.length - visibleCount;
        if (remaining <= 0) return;

        const toShow = Math.min(BATCH_SIZE, remaining);
        for (let i = 0; i < toShow; i++) {
            const img = galleryItems[visibleCount + i];
            if (img) img.style.display = "block";
        }
        visibleCount += toShow;
    }

    function handleScroll() {
        if (isLoading) return;
        if (visibleCount >= galleryItems.length) return;

        const rect = gallerySection.getBoundingClientRect();
        const viewHeight = window.innerHeight || document.documentElement.clientHeight;

        if (rect.bottom - 120 <= viewHeight) {
            isLoading = true;
            if (gallerySpinner) gallerySpinner.style.display = "flex";

            const delay = 700 + Math.random() * 500;

            setTimeout(() => {
                showMoreImages();
                isLoading = false;
                if (gallerySpinner) gallerySpinner.style.display = "none";
            }, delay);
        }
    }

    let lightboxPrevArrow = null;
    let lightboxNextArrow = null;

    function createLightbox() {
        lightboxOverlay = document.createElement("div");
        lightboxOverlay.className = "gallery-lightbox-overlay";
        lightboxOverlay.innerHTML = `
      <button class="gallery-lightbox-arrow left">â€¹</button>
      <img class="gallery-lightbox-image" src="" alt="photo detail">
      <button class="gallery-lightbox-arrow right">â€º</button>
    `;
        document.body.appendChild(lightboxOverlay);

        lightboxImg       = lightboxOverlay.querySelector(".gallery-lightbox-image");
        lightboxPrevArrow = lightboxOverlay.querySelector(".gallery-lightbox-arrow.left");
        lightboxNextArrow = lightboxOverlay.querySelector(".gallery-lightbox-arrow.right");

        lightboxOverlay.addEventListener("click", (e) => {
            if (e.target === lightboxImg || e.target === lightboxPrevArrow || e.target === lightboxNextArrow) return;
            closeLightbox();
        });

        lightboxImg.addEventListener("click", closeLightbox);

        lightboxPrevArrow.addEventListener("click", (e) => {
            e.stopPropagation();
            showPrevPhoto();
        });
        lightboxNextArrow.addEventListener("click", (e) => {
            e.stopPropagation();
            showNextPhoto();
        });

        window.addEventListener("keydown", (e) => {
            if (!lightboxOverlay.classList.contains("show")) return;

            if (e.key === "Escape") closeLightbox();
            else if (e.key === "ArrowLeft") showPrevPhoto();
            else if (e.key === "ArrowRight") showNextPhoto();
        });
    }

    function updateLightboxArrows() {
        const total = galleryItems.length;
        if (!lightboxPrevArrow || !lightboxNextArrow) return;

        lightboxPrevArrow.style.display = (currentIndex <= 0) ? "none" : "flex";
        lightboxNextArrow.style.display = (currentIndex >= total - 1) ? "none" : "flex";
    }

    function openLightbox(index) {
        if (!lightboxOverlay) createLightbox();
        currentIndex = index;
        lightboxImg.src = galleryItems[currentIndex].src;
        lightboxOverlay.classList.add("show");
        updateLightboxArrows();
    }

    function closeLightbox() {
        if (!lightboxOverlay) return;
        lightboxOverlay.classList.remove("show");
    }

    function showPrevPhoto() {
        if (currentIndex <= 0) return;
        currentIndex--;
        lightboxImg.src = galleryItems[currentIndex].src;
        updateLightboxArrows();
    }

    function showNextPhoto() {
        if (currentIndex >= galleryItems.length - 1) return;
        currentIndex++;
        lightboxImg.src = galleryItems[currentIndex].src;
        updateLightboxArrows();
    }

    // âœ… loadì—ì„œ ê¶Œí•œ ì ìš© + ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€
    window.addEventListener("load", async () => {
        const profileImg = document.getElementById("profilePhoto");
        if (profileImg) {
            const placeholder = profileImg.getAttribute("src");
            const realSrc = profileImg.dataset.profileSrc;

            if (realSrc && realSrc.trim() !== "") {
                profileImg.src = realSrc;
                profileImg.onerror = () => {
                    profileImg.onerror = null;
                    profileImg.src = placeholder;
                };
            }
        }

        // (1) ë¡œê·¸ì¸ ì‚¬ìš©ì ë³µêµ¬
        const me = await restoreMeSafe();

        // (2) í˜„ì¬ í”„ë¡œí•„ person ì¡°íšŒ (id í•„ìˆ˜)
        let person = null;
        try {
            const username = getUsernameFromPath();
            if (username) person = await fetchPersonByName(username);
        } catch (e) {}

        // (3) id ê¸°ë°˜ owner íŒë‹¨
        const isOwner = computeIsOwnerById(me, person);

        // (4) UI í† ê¸€ ì ìš©
        applyOwnerUI(isOwner);

        // (5) ê¸°ì¡´ empty UI ë°˜ì˜
        updateEmptyUI();

        // ê¸°ì¡´ ê°¤ëŸ¬ë¦¬ ë¡œì§ ìœ ì§€
        if (galleryItems.length > 0) {
            initGallery();
            galleryItems.forEach((img, idx) => {
                img.style.cursor = "pointer";
                img.addEventListener("click", () => openLightbox(idx));
            });

            if (galleryItems.length > INITIAL_COUNT) {
                window.addEventListener("scroll", handleScroll);
                handleScroll();
            }
        }

        // í¸ì§‘ ì˜¤ë²„ë ˆì´ ì´ë²¤íŠ¸ëŠ” ì†Œìœ ìì¼ ë•Œë§Œ
        if (isOwner) setupEditOverlay();
    });
</script>

<!-- empty UI ìë™ ê°±ì‹  ì˜µì €ë²„ -->
<script>
    (function autoUpdateEmptyUI(){
        if (window.__emptyUIObserver) {
            window.__emptyUIObserver.disconnect();
            window.__emptyUIObserver = null;
        }

        const filmSlider   = document.getElementById("filmSlider");
        const galleryGrid  = document.getElementById("galleryGrid");
        const profileInfo  = document.querySelector(".profile-info");

        let scheduled = false;
        const schedule = () => {
            if (scheduled) return;
            scheduled = true;

            requestAnimationFrame(() => {
                scheduled = false;

                if (typeof updateEmptyUI === "function") updateEmptyUI();
                if (typeof updateArrows === "function") updateArrows();
            });
        };

        const observer = new MutationObserver(() => { schedule(); });

        const config = {
            childList: true,
            subtree: true,
            attributes: true,
            characterData: true
        };

        if (filmSlider)  observer.observe(filmSlider, config);
        if (galleryGrid) observer.observe(galleryGrid, config);
        if (profileInfo) observer.observe(profileInfo, config);

        window.__emptyUIObserver = observer;
        schedule();
    })();
</script>

<!-- empty UI í† ê¸€ -->
<script>
    function updateEmptyUI(){
        const profileHeader = document.querySelector(".profile-header");
        const nameEl = document.getElementById("profileName");
        const metaEl = document.getElementById("profileMeta");
        const bioEl  = document.getElementById("bioDisplay");

        const snsRow = document.querySelector(".sns-row");
        const tagList = document.getElementById("tagList");

        const hasName = !!(nameEl?.dataset.value?.trim());
        const hasMeta = !!(metaEl?.dataset.birthDate?.trim() || metaEl?.dataset.birthPlace?.trim());
        const hasBio  = !!(bioEl?.dataset.value?.trim());
        const hasSns  = snsRow && snsRow.querySelectorAll("a.sns-pill").length > 0;
        const hasTags = tagList && tagList.querySelectorAll(".profile-tag").length > 0;

        const profileHasAny = hasName || hasMeta || hasBio || hasSns || hasTags;

        snsRow?.classList.toggle("is-empty", !hasSns);
        tagList?.classList.toggle("is-empty", !hasTags);

        if (profileHeader) profileHeader.classList.toggle("is-empty", !profileHasAny);

        const isOwner = !!window.__isOwner;

        // ---- FILMOGRAPHY ----
        const filmSlider = document.getElementById("filmSlider");
        const filmCards  = filmSlider ? filmSlider.querySelectorAll(".film-card") : [];
        const filmEmpty  = document.getElementById("filmEmpty"); // owner CTA
        const filmEmptyViewOnly = document.getElementById("filmEmptyViewOnly"); // âœ… ì¶”ê°€

        const hasFilms = filmCards.length > 0;

        // ì†Œìœ ì CTA
        if (filmEmpty) filmEmpty.classList.toggle("hidden", hasFilms || !isOwner);

        // âœ… ë¹„ì†Œìœ ì(ë¹„ë¡œê·¸ì¸ í¬í•¨) ì•ˆë‚´
        if (filmEmptyViewOnly) filmEmptyViewOnly.classList.toggle("hidden", hasFilms || isOwner);

        const filmWrapper = document.querySelector("#filmSliderContainer .film-slider-wrapper");
        const filmPrev = document.getElementById("filmPrevBtn");
        const filmNext = document.getElementById("filmNextBtn");

        if (filmWrapper) filmWrapper.classList.toggle("hidden", !hasFilms);
        if (filmPrev) filmPrev.classList.toggle("hidden", !hasFilms);
        if (filmNext) filmNext.classList.toggle("hidden", !hasFilms);

        // ---- GALLERY ----
        const galleryGridEl = document.getElementById("galleryGrid");
        const galleryEmpty  = document.getElementById("galleryEmpty"); // owner CTA
        const galleryEmptyViewOnly = document.getElementById("galleryEmptyViewOnly"); // âœ… ì¶”ê°€

        const galleryImgs   = galleryGridEl ? galleryGridEl.querySelectorAll(".gallery-item") : [];
        const hasGallery = galleryImgs.length > 0;

        // ì†Œìœ ì CTA
        if (galleryEmpty) galleryEmpty.classList.toggle("hidden", hasGallery || !isOwner);

        // âœ… ë¹„ì†Œìœ ì ì•ˆë‚´
        if (galleryEmptyViewOnly) galleryEmptyViewOnly.classList.toggle("hidden", hasGallery || isOwner);
    }

    function setupEditOverlay(){
        const settingsBtn = document.getElementById("profileSettingsBtn");
        const editOverlay = document.getElementById("profileEditOverlay");
        const editCard    = editOverlay ? editOverlay.querySelector(".profile-edit-card") : null;

        if (!settingsBtn || !editOverlay || !editCard) return;

        function lockScroll(lock){
            document.body.style.overflow = lock ? "hidden" : "";
        }

        function closeEditOverlay(){
            editOverlay.classList.remove("show");
            settingsBtn.setAttribute("aria-expanded", "false");
            lockScroll(false);
        }

        settingsBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            editOverlay.classList.add("show");
            settingsBtn.setAttribute("aria-expanded", "true");
            lockScroll(true);
        });

        editOverlay.addEventListener("click", (e) => {
            if (!editCard.contains(e.target)) {
                closeEditOverlay();
                return;
            }

            const item = e.target.closest(".profile-settings-item");
            if (!item) return;

            const action = item.dataset.action;
            if (action === "profile") window.location.href = "/edit-profile.html";
            else if (action === "filmography") window.location.href = "/edit-filmography.html";
            else if (action === "gallery") window.location.href = "/edit-gallery.html";

            closeEditOverlay();
        });

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && editOverlay.classList.contains("show")) closeEditOverlay();
        });
    }
</script>

<!-- ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´: ì—´ê¸°/ë‹«ê¸°(ESC/ë°”ê¹¥í´ë¦­) + ë¡œê·¸ì¸ ì œì¶œ ì—°ê²° -->
<script>
    function openLoginOverlay(){
        const overlay = document.getElementById("loginOverlay");
        if (!overlay) return;
        overlay.classList.add("show");
    }

    function closeLoginOverlay(){
        const overlay = document.getElementById("loginOverlay");
        if (!overlay) return;
        overlay.classList.remove("show");
    }

    // âœ… 1) loginBtnì€ í—¤ë”ì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë˜ë¯€ë¡œ "ì´ë²¤íŠ¸ ìœ„ì„"ìœ¼ë¡œ ì²˜ë¦¬
    document.addEventListener("click", (e) => {
        // ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ -> ì˜¤ë²„ë ˆì´ ì—´ê¸°
        const loginBtn = e.target?.closest?.("#loginBtn");
        if (loginBtn) {
            openLoginOverlay();
            return;
        }

        // ì˜¤ë²„ë ˆì´ ë°”ê¹¥ í´ë¦­ -> ë‹«ê¸°
        const overlay = document.getElementById("loginOverlay");
        if (overlay && overlay.classList.contains("show") && e.target === overlay) {
            closeLoginOverlay();
        }
    });

    // âœ… 2) ESC -> ë‹«ê¸°
    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeLoginOverlay();
    });

    // âœ… 3) ë¡œê·¸ì¸ ì œì¶œ ë²„íŠ¼ í´ë¦­ -> OnfilmAuth.login í˜¸ì¶œ
    document.addEventListener("click", async (e) => {
        const submitBtn = e.target?.closest?.("#loginSubmitBtn");
        if (!submitBtn) return;

        const email = document.getElementById("loginEmail")?.value?.trim() || "";
        const password = document.getElementById("loginPassword")?.value || "";

        if (!email || !password) {
            alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
            return;
        }

        // ì¤‘ë³µ í´ë¦­ ë°©ì§€
        submitBtn.disabled = true;

        try {
            // auth.jsì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í•¨ìˆ˜
            await window.OnfilmAuth.login(email, password);

            // ì„±ê³µ: ì˜¤ë²„ë ˆì´ ë‹«ê³  í—¤ë”/ê¶Œí•œ UI ê°±ì‹ 
            closeLoginOverlay();

            if (typeof renderHeaderActions === "function") {
                await renderHeaderActions();
            }

            // í”„ë¡œí•„ ì†Œìœ ì UI ì¦‰ì‹œ ì¬íŒì •(ìˆìœ¼ë©´)
            if (typeof initProfilePage === "function") {
                await initProfilePage();
            }
        } catch (err) {
            console.error(err);
            alert(err?.message || "ë¡œê·¸ì¸ ì‹¤íŒ¨");
        } finally {
            submitBtn.disabled = false;
        }
    });

    // ?login=trueë©´ ìë™ ì˜¤í”ˆ
    document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        if (params.get("login") === "true") openLoginOverlay();
    });
</script>


<!-- í—¤ë” ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë©”ë‰´ -->
<script>
    function normalizeMe(me) {
        const username = me?.username ? String(me.username).trim() : "";
        const displayName = (me?.displayName || me?.name || username || me?.email || "ë‚´ ê³„ì •");
        const avatarUrl = me?.avatarUrl || me?.profileImageUrl || me?.profileImage || "";
        return { username, displayName, avatarUrl };
    }

    function renderLoggedOut(container){
        container.innerHTML = `
      <button type="button" class="login-btn" id="loginBtn">ë¡œê·¸ì¸</button>
    `;
        // âœ… í´ë¦­ ì´ë²¤íŠ¸ëŠ” ìœ„ì—ì„œ ì´ë¯¸ (ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ) openLoginOverlay ì²˜ë¦¬í•˜ê³  ìˆìœ¼ë‹ˆ ì—¬ê¸°ì„  ì•ˆ ë¶™ì„
    }

    function renderLoggedIn(container, me){
        const { username, displayName, avatarUrl } = normalizeMe(me);

        const baseForInitial = username || displayName; // âœ… indexì²˜ëŸ¼ username ìš°ì„ 
        const initial = (baseForInitial.trim().charAt(0) || "A").toUpperCase();

        container.innerHTML = `
      <div class="profile-menu">
        <button type="button" class="profile-avatar-btn" id="profileAvatarBtn" aria-label="ê³„ì • ë©”ë‰´ ì—´ê¸°">
          ${
            avatarUrl
                ? `<img src="${avatarUrl}" alt="${displayName} í”„ë¡œí•„" />`
                : `<span class="profile-avatar-initial">${initial}</span>`
        }
        </button>

        <div class="profile-dropdown" id="profileDropdown">
          <div class="profile-group-title">${displayName}</div>

          <button type="button" class="profile-item" data-action="actor-page">
            ë‚´ ë°°ìš° í˜ì´ì§€
            <span>í”„ë¡œí•„ ë³´ê¸°</span>
          </button>

          <div class="profile-divider"></div>
          <div class="profile-group-title">í¸ì§‘</div>

          <button type="button" class="profile-item" data-action="edit-profile">
            í”„ë¡œí•„ í¸ì§‘
            <span>ê¸°ë³¸ì •ë³´</span>
          </button>

          <button type="button" class="profile-item" data-action="edit-filmography">
            í•„ëª¨ê·¸ë˜í”¼ í¸ì§‘
            <span>ì‘í’ˆ/ì—­í• </span>
          </button>

          <button type="button" class="profile-item" data-action="edit-gallery">
            ê°¤ëŸ¬ë¦¬ í¸ì§‘
            <span>ì‚¬ì§„/ì˜ìƒ</span>
          </button>

          <div class="profile-divider"></div>

          <button type="button" class="profile-item" data-action="account-settings">
            ê³„ì • ì„¤ì •
            <span>ë¹„ë°€ë²ˆí˜¸/ì—°ë™</span>
          </button>

          <button type="button" class="profile-item" data-action="logout">
            ë¡œê·¸ì•„ì›ƒ
          </button>
        </div>
      </div>
    `;

        const avatarBtn = document.getElementById("profileAvatarBtn");
        const dropdown  = document.getElementById("profileDropdown");
        if (!avatarBtn || !dropdown) return;

        const close = () => dropdown.classList.remove("open");

        avatarBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown.classList.toggle("open");
        });

        dropdown.querySelectorAll(".profile-item").forEach(btn => {
            btn.addEventListener("click", async () => {
                const action = btn.dataset.action;
                close();

                if (action === "actor-page") {
                    const myId = me?.id;
                    if (!myId) {
                        openLoginOverlay?.();
                        return;
                    }

                    const uname = (me?.username ? String(me.username).trim() : "");
                    if (!uname) {
                        window.location.href = "/edit-profile.html";
                        return;
                    }

                    try {
                        const res = await fetch(`/persons/${encodeURIComponent(uname)}`, {
                            headers: { "Accept": "application/json" }
                        });

                        if (!res.ok) {
                            window.location.href = "/edit-profile.html";
                            return;
                        }

                        const p = await res.json();

                        const hasAny =
                            !!(p?.name && String(p.name).trim()) ||
                            !!(p?.oneLineIntro && String(p.oneLineIntro).trim()) ||
                            !!(p?.birthDate && String(p.birthDate).trim()) ||
                            !!(p?.birthPlace && String(p.birthPlace).trim()) ||
                            !!(p?.profileImageUrl && String(p.profileImageUrl).trim()) ||
                            (Array.isArray(p?.snsList) && p.snsList.length > 0) ||
                            (Array.isArray(p?.rawTags) && p.rawTags.length > 0);

                        if (!hasAny) {
                            window.location.href = "/edit-profile.html";
                            return;
                        }

                        window.location.href = "/onfilm/" + encodeURIComponent(uname);
                    } catch (_) {
                        window.location.href = "/edit-profile.html";
                    }
                    return;
                }

                if (action === "edit-profile") {
                    window.location.href = "/edit-profile.html";
                    return;
                }
                if (action === "edit-filmography") {
                    window.location.href = "/edit-filmography.html";
                    return;
                }
                if (action === "edit-gallery") {
                    window.location.href = "/edit-gallery.html";
                    return;
                }
                if (action === "account-settings") {
                    window.location.href = "/account-settings.html";
                    return;
                }

                if (action === "logout") {
                    await window.OnfilmAuth.logout();
                    renderLoggedOut(container);

                    // âœ… ë¡œê·¸ì•„ì›ƒí•˜ë©´ owner UI ë‚´ë ¤ì£¼ê¸° (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
                    applyOwnerUI(false);
                    if (typeof updateEmptyUI === "function") updateEmptyUI();
                    return;
                }
            });
        });

        // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸° (indexì™€ ë™ì¼í•œ ë°©ì‹)
        document.addEventListener("click", (e) => {
            if (!dropdown.contains(e.target) && e.target !== avatarBtn) close();
        });

        // ESCë¡œ ë‹«ê¸°
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") close();
        });
    }

    async function renderHeaderActions(){
        const container = document.getElementById("headerActions");
        if (!container) return;

        renderLoggedOut(container);

        try {
            const result = await window.OnfilmAuth.restoreSession();
            if (result && result.ok && result.me) {
                renderLoggedIn(container, result.me);
            } else {
                renderLoggedOut(container);
            }
        } catch (e) {
            console.error("restoreSession failed", e);
            renderLoggedOut(container);
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        renderHeaderActions();

        const params = new URLSearchParams(window.location.search);
        const loginOverlay = document.getElementById("loginOverlay");
        if (loginOverlay && params.get("login") === "true") {
            loginOverlay.classList.add("show");
        }
    });
</script>


<!-- í”„ë¡œí•„ ë°ì´í„° ë°”ì¸ë”© -->
<script>
    function applyPersonToUI(p) {
        // ì´ë¦„
        const nameEl = document.getElementById("profileName");
        if (nameEl) {
            nameEl.textContent = p?.name || "íšŒì›";
            nameEl.dataset.value = p?.name || "";
        }

        // ë©”íƒ€
        const metaEl = document.getElementById("profileMeta");
        if (metaEl) {
            const birthDate = p?.birthDate || "";
            const birthPlace = p?.birthPlace || "";
            metaEl.dataset.birthDate = birthDate;
            metaEl.dataset.birthPlace = birthPlace;

            const left = birthDate ? birthDate : "ìƒë…„ì›”ì¼ ë¯¸ë“±ë¡";
            const right = birthPlace ? birthPlace : "ì¶œìƒì§€ ë¯¸ë“±ë¡";
            metaEl.textContent = `${left} Â· ${right}`;
        }

        // ì†Œê°œ
        const bioEl = document.getElementById("bioDisplay");
        if (bioEl) {
            bioEl.textContent = p?.oneLineIntro || "ì†Œê°œê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
            bioEl.dataset.value = p?.oneLineIntro || "";
        }

        // ì´ë¯¸ì§€
        const imgEl = document.getElementById("profilePhoto");
        if (imgEl) {
            const placeholder = imgEl.getAttribute("src");
            const real = (p?.profileImageUrl || "").trim();
            imgEl.dataset.profileSrc = real;
            imgEl.src = real || placeholder;
            imgEl.onerror = () => { imgEl.onerror = null; imgEl.src = placeholder; };
        }

        // SNS
        const snsRow = document.getElementById("snsRow");
        if (snsRow) {
            snsRow.innerHTML = "";
            const list = Array.isArray(p?.snsList) ? p.snsList : [];
            list.forEach(sns => {
                const type = (sns?.type || "").toString().toUpperCase();
                const url = (sns?.url || "").toString();
                if (!url) return;

                const brand =
                    type === "INSTAGRAM" ? "instagram" :
                        type === "YOUTUBE" ? "youtube" :
                            type === "NAVER" ? "naver" :
                                (type === "TWITTER" || type === "X") ? "x" : "x";

                const a = document.createElement("a");
                a.className = "sns-pill";
                a.href = url;
                a.target = "_blank";
                a.rel = "noopener";
                a.dataset.brand = brand;
                a.innerHTML = `
          <span class="sns-badge"><span class="sns-icon"></span></span>
          <span>${type}</span>
          <span class="sns-handle">${new URL(url).hostname}</span>
        `;
                snsRow.appendChild(a);
            });
        }

        // íƒœê·¸
        const tagListEl = document.getElementById("tagList");
        if (tagListEl) {
            tagListEl.innerHTML = "";
            const tags = Array.isArray(p?.rawTags) ? p.rawTags : [];
            tags.forEach(t => {
                const raw = (t?.rawTag || "").toString().trim();
                if (!raw) return;
                const span = document.createElement("span");
                span.className = "profile-tag";
                span.textContent = raw.startsWith("#") ? raw : `#${raw}`;
                tagListEl.appendChild(span);
            });
        }

        // empty UI ë°˜ì˜
        if (typeof updateEmptyUI === "function") updateEmptyUI();
    }

    // ===== FILMOGRAPHY: APIë¡œ ì¹´ë“œ ë Œë”ë§ =====

    // nameì€ ë„ˆê°€ URLì— ì“°ëŠ” ì‹ë³„ì(í˜„ì¬ëŠ” usernameì´ì§€ë§Œ, ì•ìœ¼ë¡œ nameìœ¼ë¡œ ë°”ê¿€ ì˜ˆì •ì´ë‹ˆê¹Œ ë³€ìˆ˜ëª…ì€ nameìœ¼ë¡œ)
    async function fetchFilmographyByName(name) {
        // âš ï¸ ì—¬ê¸° URLë§Œ ë„ˆ ë°±ì—”ë“œì— ë§ì¶° ìˆ˜ì •í•˜ë©´ ë¨
        // ì˜ˆ: /persons/{name}/movies   ë˜ëŠ” /persons/{name}/filmography
        const res = await fetch(`/persons/${encodeURIComponent(name)}/movies`, {
            method: "GET",
            headers: { "Accept": "application/json" }
        });

        if (!res.ok) {
            // 404ë©´ í•„ëª¨ 0ê°œë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ìœ¼ë©´ ì—¬ê¸°ì„œ [] ë¦¬í„´í•´ë„ ë¨
            throw new Error("GET_FILMOGRAPHY_FAILED status=" + res.status);
        }
        return await res.json(); // List<MovieCardResponse>
    }

    function ageToBadge(ageRating) {
        // ë°±ì—”ë“œ enum: ALL, AGE_12, AGE_15, AGE_18
        switch ((ageRating || "").toUpperCase()) {
            case "ALL": return "ALL";
            case "AGE_12": return "12";
            case "AGE_15": return "15";
            case "AGE_18": return "18";
            default: return ""; // fallback
        }
    }

    function castTypeToKorean(castType) {
        switch ((castType || "").toUpperCase()) {
            case "LEAD": return "ì£¼ì—°";
            case "SUPPORTING": return "ì¡°ì—°";
            case "CAMEO": return "ì¹´ë©”ì˜¤";
            default: return "";
        }
    }

    // film-card í•œ ì¥ ìƒì„±
    function createFilmCard(item) {
        const article = document.createElement("article");
        article.className = "film-card";

        const title = item?.title ?? "";
        const genre = item?.genre ?? "";
        const runtime = (item?.runtime !== undefined && item?.runtime !== null) ? `${item.runtime}ë¶„` : "";
        const age = ageToBadge(item?.ageRating);
        const video = item?.trailerUrl || "";      // íŒì—… video srcë¡œ ì‚¬ìš©
        const thumb = item?.thumbnailUrl || "";    // íŒì—… thumbë¡œ ì‚¬ìš©

        const releaseYear = (item?.releaseYear !== undefined && item?.releaseYear !== null)
            ? String(item.releaseYear)
            : "";

        const castLabel = castTypeToKorean(item?.castType);

        // âœ… "2025 Â· ì£¼ì—°" í˜•ì‹ ë§Œë“¤ê¸°
        const metaText =
            (releaseYear && castLabel) ? `${releaseYear} Â· ${castLabel}` :
                (releaseYear) ? releaseYear :
                    (castLabel) ? castLabel :
                        "";

        article.dataset.title = title;
        article.dataset.genre = genre;
        article.dataset.runtime = runtime;
        article.dataset.age = age;
        article.dataset.video = video;
        article.dataset.thumb = thumb;
        article.dataset.releaseYear = releaseYear;
        article.dataset.castLabel = castLabel;


        article.innerHTML = `
    <img class="film-poster" src="${thumb || "/videos/thumbnail.png"}" alt="">
    <div class="film-body">
      <div class="film-title">${escapeHtml(title)}</div>
      <div class="film-meta">${escapeHtml(metaText)}</div>
    </div>
  `;

        // poster ê¹¨ì§€ë©´ placeholder
        const img = article.querySelector("img.film-poster");
        if (img) {
            img.onerror = () => {
                img.onerror = null;
                img.src = "/videos/thumbnail.png";
            };
        }

        return article;
    }

    // XSS ë°©ì§€ìš©(ê°„ë‹¨)
    function escapeHtml(str) {
        return String(str ?? "")
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");
    }

    // filmSlider ë¹„ìš°ê³  ë‹¤ì‹œ ë Œë”
    async function renderFilmography(name) {
        const filmSlider = document.getElementById("filmSlider");
        if (!filmSlider) return;

        // ê¸°ì¡´ ì¹´ë“œ ì œê±°
        filmSlider.innerHTML = "";

        try {
            const list = await fetchFilmographyByName(name);
            const movies = Array.isArray(list) ? list : [];

            movies.forEach(item => {
                filmSlider.appendChild(createFilmCard(item));
            });

            // ìŠ¬ë¼ì´ë” index ì´ˆê¸°í™” + UI ê°±ì‹ 
            if (typeof window.index !== "undefined") window.index = 0; // ë„¤ ì½”ë“œì˜ index ë³€ìˆ˜ ì¬ì‚¬ìš©
            if (typeof updateSlider === "function") updateSlider();
            if (typeof updateEmptyUI === "function") updateEmptyUI();
            if (typeof updateArrows === "function") updateArrows();
        } catch (e) {
            console.error("renderFilmography error:", e);

            // ì‹¤íŒ¨í•´ë„ empty UIëŠ” ë§ì¶°ì£¼ê¸°
            if (typeof updateEmptyUI === "function") updateEmptyUI();
            if (typeof updateArrows === "function") updateArrows();
        }
    }

    async function initProfilePage() {
        const username = getUsernameFromPath();
        if (!username) return;

        try {
            const person = await fetchPersonByName(username);
            applyPersonToUI(person);

            await renderFilmography(username);

            // âœ… person ë¡œë”©ì´ ëë‚œ ì‹œì ì—, meë„ ë‹¤ì‹œ ê°€ì ¸ì™€ì„œ owner íŒë‹¨ì„ â€œí™•ì •â€ (id ê¸°ë°˜)
            const me = await restoreMeSafe();
            const isOwner = computeIsOwnerById(me, person);
            applyOwnerUI(isOwner);
            // âœ… ë‚´ í”„ë¡œí•„ì¸ë° "ì•„ë¬´ ì •ë³´ë„ ì—†ìœ¼ë©´" editë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            if (isOwner) {
                const hasAny =
                    !!(person?.name && String(person.name).trim()) ||
                    !!(person?.oneLineIntro && String(person.oneLineIntro).trim()) ||
                    !!(person?.birthDate && String(person.birthDate).trim()) ||
                    !!(person?.birthPlace && String(person.birthPlace).trim()) ||
                    !!(person?.profileImageUrl && String(person.profileImageUrl).trim()) ||
                    (Array.isArray(person?.snsList) && person.snsList.length > 0) ||
                    (Array.isArray(person?.rawTags) && person.rawTags.length > 0);

                if (!hasAny) {
                    window.location.replace("/edit-profile.html");
                    return;
                }
            }

            if (typeof updateEmptyUI === "function") updateEmptyUI();
        } catch (e) {
            console.error(e);
            const nameEl = document.getElementById("profileName");
            if (nameEl) nameEl.textContent = "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”„ë¡œí•„";
            applyOwnerUI(false);
            if (typeof updateEmptyUI === "function") updateEmptyUI();
        }
    }

    document.addEventListener("DOMContentLoaded", initProfilePage);
</script>
</body>
</html>
