<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OnFilm – 로그인</title>

    <style>
        :root{
            --bg:#0b0c0f;
            --panel:#12131a;
            --panel-2:#161824;
            --text:#e7e8ee;
            --muted:#9aa0ad;
            --line:rgba(255,255,255,.08);
            --accent:#7c5cff;
            --accent-2:#24d39a;
            --radius-lg:14px;
            --radius-md:10px;
            --radius-xl:20px;
            --shadow:0 10px 40px rgba(0,0,0,.5);
        }

        *{box-sizing:border-box;}
        body{
            margin:0;
            font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;
            color:var(--text);
            background:
                    radial-gradient(900px 400px at 80% 0%, rgba(124,92,255,.2), transparent 60%),
                    radial-gradient(700px 350px at 10% 10%, rgba(36,211,154,.15), transparent 60%),
                    var(--bg);
        }

        .container{
            width:min(1100px,92vw);
            margin:0 auto;
        }

        /* HEADER */
        header{
            position:sticky; top:0; z-index:10;
            background:rgba(11,12,15,.85);
            backdrop-filter:blur(8px);
            border-bottom:1px solid var(--line);
        }
        .header-row{
            height:56px;
            display:flex;
            align-items:center;
            justify-content:space-between;
        }
        .logo{
            font-weight:800;
            font-size:18px;
            color:var(--text);
            text-decoration:none;
        }
        .header-btn{
            padding:6px 14px;
            font-size:13px;
            border-radius:999px;
            border:1px solid var(--line);
            background:rgba(255,255,255,0.06);
            color:var(--text);
            cursor:pointer;
            font-weight:600;
            transition:background .15s ease, border-color .15s ease, transform .12s ease;
        }
        .header-btn:hover{
            background:rgba(124,92,255,0.22);
            border-color:var(--accent);
            transform:translateY(-1px);
        }

        /* ===============================
           로그인 전체 화면 레이아웃
        =============================== */
        .login-root{
            min-height:calc(100vh - 56px);
            display:flex;
            align-items:center;
            justify-content:center;
            padding:32px 12px 40px;
        }

        .login-card{
            width:min(420px, 100%);
            background:var(--panel-2);
            border-radius:var(--radius-xl);
            border:1px solid var(--line);
            box-shadow:0 20px 60px rgba(0,0,0,.9);
            padding:24px 24px 20px;
        }

        .login-title{
            font-size:22px;
            font-weight:800;
            margin-bottom:4px;
        }

        .login-label{
            display:block;
            font-size:13px;
            font-weight:600;
            color:var(--muted);
            margin:12px 0 6px;
        }

        .login-input{
            width:100%;
            padding:9px 11px;
            border-radius:10px;
            border:1px solid var(--line);
            background:rgba(0,0,0,.25);
            color:var(--text);
            font-size:13px;
            outline:none;
            transition:border-color .15s ease, background .15s ease;
        }
        .login-input::placeholder{
            color:rgba(154,160,173,.7);
        }
        .login-input:focus{
            border-color:var(--accent);
            background:rgba(15,16,25,.95);
        }

        /* 비밀번호 필드 + 눈 아이콘 */
        .password-field{
            position:relative;
        }
        .toggle-visibility-btn{
            position:absolute;
            top:50%;
            right:10px;
            transform:translateY(-50%);
            border:none;
            background:transparent;
            cursor:pointer;
            padding:0;
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .toggle-visibility-btn svg{
            width:18px;
            height:18px;
            color:var(--muted);
            transition:color .15s ease, transform .12s ease;
        }
        .toggle-visibility-btn:hover svg{
            color:var(--accent);
            transform:scale(1.05);
        }
        .icon-visible{ display:none; }   /* 눈 (문자열 보임) */
        .icon-hidden{ display:block; }   /* 눈+슬래시 (*** 상태) */

        .login-submit-btn{
            margin-top:18px;
            width:100%;
            padding:10px 0;
            border-radius:999px;
            border:none;
            background:var(--accent);
            color:#fff;
            font-size:14px;
            font-weight:700;
            cursor:pointer;
            transition:background .15s ease, transform .12s ease, opacity .12s ease;
        }
        .login-submit-btn:hover:not(:disabled){
            background:#8a6dff;
            transform:translateY(-1px);
        }
        .login-submit-btn:disabled{
            opacity:.5;
            cursor:not-allowed;
        }

        /* 이메일/비번 오류 메시지용 (필요 시 사용) */
        .login-error{
            font-size:11px;
            color:#ff7b7b;
            margin-top:4px;
            display:none;
        }

        /* 구분선 */
        .login-divider{
            display:flex;
            align-items:center;
            gap:8px;
            margin:18px 0 12px;
            font-size:11px;
            color:var(--muted);
        }
        .login-divider-line{
            flex:1;
            height:1px;
            background:rgba(255,255,255,.14);
        }

        /* 소셜 로그인 버튼 */
        .social-row{
            display:flex;
            flex-direction:column;
            gap:8px;
        }
        .social-btn{
            width:100%;
            padding:8px 10px;
            border-radius:999px;
            border:none;
            font-size:13px;
            font-weight:600;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            gap:6px;
            transition:transform .12s ease, box-shadow .12s ease, background .15s ease;
        }
        .social-btn:hover{
            transform:translateY(-1px);
            box-shadow:0 6px 18px rgba(0,0,0,.55);
        }
        .social-google{
            background:#ffffff;
            color:#111111;
        }
        .social-naver{
            background:#03c75a;
            color:#ffffff;
        }

        /* 하단 링크들 */
        .login-footer-links{
            margin-top:14px;
            font-size:12px;
            color:var(--muted);
            text-align:center;
        }
        .login-footer-links a{
            color:var(--text);
            text-decoration:none;
            margin:0 4px;
        }
        .login-footer-links a:hover{
            text-decoration:underline;
        }

    </style>
</head>
<body>

<header>
    <div class="container header-row">
        <a href="index.html" class="logo">OnFilm</a>
        <button
                type="button"
                class="header-btn"
                onclick="location.href='signup.html'">
            회원가입
        </button>
    </div>
</header>

<main class="login-root">
    <div class="login-card">
        <h1 class="login-title">로그인</h1>

        <!-- 이메일(아이디) -->
        <label class="login-label" for="loginEmail">아이디</label>
        <input
                id="loginEmail"
                class="login-input"
                type="email"
                placeholder="name@example.com"
        />

        <!-- 비밀번호 -->
        <label class="login-label" for="loginPassword">비밀번호</label>
        <div class="password-field">
            <input
                    id="loginPassword"
                    class="login-input"
                    type="password"
                    placeholder="비밀번호를 입력하세요"
            />
            <button
                    type="button"
                    class="toggle-visibility-btn"
                    data-target="loginPassword"
            >
                <!-- 문자열이 보이는 상태(눈) -->
                <svg class="icon-visible" xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7
                   -1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    <circle cx="12" cy="12" r="3"/>
                </svg>
                <!-- 가려진 상태(눈 + 슬래시) -->
                <svg class="icon-hidden" xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3 3l18 18"/>
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M10.477 10.485A3 3 0 0 0 13.5 13.5m-1.53 2.472A3.001 3.001 0 0 1 8.03 11.03M9.88 4.615A9.76 9.76 0 0 1 12 4.5c4.477 0 8.268 2.943 9.543 7
                   -.37 1.178-.94 2.266-1.676 3.222M6.228 6.228C4.35 7.35 2.942 9.24 2.457 12
                   A10.45 10.45 0 0 0 6.46 16.95"/>
                </svg>
            </button>
        </div>

        <p id="loginError" class="login-error">
            이메일 또는 비밀번호를 확인해주세요.
        </p>

        <button
                class="login-submit-btn"
                type="button"
                id="loginSubmitBtn"
        >
            로그인
        </button>

        <div class="login-footer-links">
            <a href="signup.html">회원가입</a> |
            <a href="find-id.html">아이디 찾기</a> |
            <a href="find-password.html">비밀번호 찾기</a>
        </div>

        <div class="login-divider">
            <span class="login-divider-line"></span>
            <span>또는</span>
            <span class="login-divider-line"></span>
        </div>

        <div class="social-row">
            <button type="button" class="social-btn social-google">
                Google로 계속하기
            </button>
            <button type="button" class="social-btn social-naver">
                네이버로 계속하기
            </button>
        </div>
    </div>
</main>

<script>
    const emailInput      = document.getElementById("loginEmail");
    const passwordInput   = document.getElementById("loginPassword");
    const loginError      = document.getElementById("loginError");
    const loginSubmitBtn  = document.getElementById("loginSubmitBtn");
    const toggleBtn       = document.querySelector(".toggle-visibility-btn");

    // ✅ access token은 "메모리"에만 저장 (새로고침하면 사라짐)
    let accessToken = null;

    function validateLoginForm() {
        const emailVal = emailInput.value.trim();
        const pwdVal   = passwordInput.value.trim();
        return emailVal.length > 0 && pwdVal.length > 0;
    }

    async function tryLogin() {
        if (!validateLoginForm()) {
            loginError.textContent = "이메일과 비밀번호를 모두 입력해주세요.";
            loginError.style.display = "block";
            return;
        }

        loginSubmitBtn.disabled = true;
        loginSubmitBtn.textContent = "로그인 중...";

        try {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();

            await window.OnfilmAuth.login(email, password);

            // next 파라미터가 있으면 그쪽으로, 없으면 홈으로
            const params = new URLSearchParams(location.search);
            const next = params.get("next");
            location.href = next ? decodeURIComponent(next) : "/index.html";
        } catch (e) {
            loginError.textContent = e.message || "로그인 실패";
            loginError.style.display = "block";
        } finally {
            loginSubmitBtn.disabled = false;
            loginSubmitBtn.textContent = "로그인";
        }
    }


    function syncPasswordToggle(visible) {
        if (!toggleBtn) return;
        const iconVisible = toggleBtn.querySelector(".icon-visible");
        const iconHidden = toggleBtn.querySelector(".icon-hidden");
        if (iconVisible) iconVisible.style.display = visible ? "block" : "none";
        if (iconHidden) iconHidden.style.display = visible ? "none" : "block";
        toggleBtn.setAttribute("aria-pressed", visible ? "true" : "false");
    }

    toggleBtn?.addEventListener("click", () => {
        if (!passwordInput) return;
        const nextVisible = passwordInput.type === "password";
        passwordInput.type = nextVisible ? "text" : "password";
        syncPasswordToggle(nextVisible);
    });

    passwordInput?.addEventListener("input", (e) => {
        const raw = e.target.value;
        const cleaned = raw.replace(/[^A-Za-z0-9]/g, "");
        if (raw !== cleaned) e.target.value = cleaned;
    });

    loginSubmitBtn.addEventListener("click", tryLogin);
    [emailInput, passwordInput].forEach(el => {
        el.addEventListener("keydown", (e) => {
            if (e.key === "Enter") tryLogin();
        });
    });
</script>
<script src="/js/auth.js"></script>

</body>
</html>
