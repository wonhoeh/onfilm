<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>프로필 편집 – OnFilm</title>

    <style>
        :root{
            --bg:#0b0c0f;
            --panel:#12131a;
            --panel-2:#161824;
            --text:#e7e8ee;
            --muted:#9aa0ad;
            --line:rgba(255,255,255,.12);
            --accent:#7c5cff;
            --accent-2:#24d39a;
            --radius-lg:14px;
            --radius-md:10px;
            --shadow:0 10px 40px rgba(0,0,0,.55);
        }

        *{box-sizing:border-box;margin:0;padding:0;}
        body{
            font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;
            background:
                    radial-gradient(900px 400px at 80% 0%, rgba(124,92,255,.2), transparent 60%),
                    radial-gradient(700px 350px at 10% 10%, rgba(36,211,154,.15), transparent 60%),
                    var(--bg);
            color:var(--text);
        }

        .page-shell{
            min-height:100vh;
            display:flex;
            flex-direction:column;
            align-items:center;
        }

        header{
            width:100%;
            border-bottom:1px solid var(--line);
            background:rgba(11,12,15,.9);
            backdrop-filter:blur(8px);
        }
        .header-inner{
            width:min(1100px,92vw);
            margin:0 auto;
            padding:14px 0;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
        }
        .header-title{
            font-size:16px;
            font-weight:700;
        }
        .back-link{
            font-size:13px;
            color:var(--muted);
            text-decoration:none;
            display:inline-flex;
            align-items:center;
            gap:4px;
        }
        .back-link:hover{
            color:var(--text);
        }

        main{
            flex:1;
            width:min(1100px,92vw);
            margin:0 auto;
            padding:26px 0 40px;
        }

        .edit-card{
            background:var(--panel);
            border-radius:var(--radius-lg);
            border:1px solid var(--line);
            box-shadow:var(--shadow);
            padding:22px 20px 24px;
            display:grid;
            grid-template-columns:260px minmax(0,1fr);
            gap:24px;
        }

        /* 좌측: 프로필 사진 */
        .photo-section{
            border-right:1px solid var(--line);
            padding-right:20px;
            display:flex;
            flex-direction:column;
            align-items:center;
            gap:16px;
        }
        .photo-preview{
            width:210px;
            height:280px;
            border-radius:var(--radius-lg);
            border:1px solid var(--line);
            object-fit:cover;
            background:#050608;
        }
        .photo-hint{
            font-size:12px;
            color:var(--muted);
            text-align:center;
            line-height:1.5;
        }
        .pill-btn{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            gap:6px;
            padding:7px 14px;
            border-radius:999px;
            border:1px solid var(--accent);
            background:rgba(124,92,255,.18);
            color:var(--text);
            font-size:13px;
            cursor:pointer;
            transition:background .15s ease, transform .1s ease;
        }
        .pill-btn:hover{
            background:rgba(124,92,255,.35);
            transform:translateY(-1px);
        }
        .pill-btn input[type="file"]{
            display:none;
        }

        /* 우측: 폼 필드들 */
        .form-section{
            display:flex;
            flex-direction:column;
            gap:18px;
        }

        .field-group{
            display:flex;
            flex-direction:column;
            gap:6px;
            margin-top: 18px;
        }
        .field-label{
            font-size:13px;
            font-weight:600;
        }
        .field-hint{
            font-size:11px;
            color:var(--muted);
        }

        .text-input,
        .select-input{
            width:100%;
            padding:8px 10px;
            border-radius:8px;
            border:1px solid var(--line);
            background:var(--panel-2);
            color:var(--text);
            font-size:14px;
            outline:none;
        }
        .text-input:focus,
        .select-input:focus{
            border-color:var(--accent);
            box-shadow:0 0 0 1px rgba(124,92,255,.35);
        }

        /* 출생년도 date 인풋 달력 아이콘을 밝게(흰색 느낌) 보이게 */
        #birthDate::-webkit-calendar-picker-indicator {
            filter: invert(1);      /* 어두운 배경에서 아이콘을 밝게 */
            cursor: pointer;
        }

        .two-col{
            display:grid;
            grid-template-columns:repeat(2,minmax(0,1fr));
            gap:12px;
            /*margin-top:12px;*/
        }

        /* SNS 섹션 */
        .sns-row{
            display:grid;
            grid-template-columns:120px minmax(0,1fr) 32px;
            gap:8px;
            align-items:center;
        }
        .sns-remove-btn{
            width:28px;
            height:28px;
            border-radius:50%;
            border:0;
            background:rgba(255,255,255,.06);
            color:var(--muted);
            cursor:pointer;
            font-size:15px;
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .sns-remove-btn:hover{
            background:rgba(255,80,80,.2);
            color:#ffb3b3;
        }
        .sns-add-btn{
            margin-top:6px;
            font-size:12px;
            padding:5px 10px;
            border-radius:999px;
            border:0;
            background:rgba(255,255,255,.08);
            color:var(--text);
            cursor:pointer;
        }
        .sns-add-btn:hover{
            background:rgba(255,255,255,.16);
        }
        .sns-list{
            display:flex;
            flex-direction:column;
            gap:8px;
            margin-top:4px;
        }

        /* 태그 섹션 */
        .tag-edit-row{
            display:flex;
            gap:6px;
            margin-top:6px;
        }
        .tag-input{
            flex:1;
        }
        .tag-add-btn{
            font-size:12px;
            padding:6px 12px;
            border-radius:999px;
            border:0;
            background:rgba(255,255,255,.08);
            color:var(--text);
            cursor:pointer;
        }
        .tag-add-btn:hover{
            background:rgba(255,255,255,.16);
        }
        .tag-list{
            display:flex;
            flex-wrap:wrap;
            gap:6px;
            margin-top:4px;
        }
        .tag-chip{
            padding:4px 10px;
            border-radius:999px;
            font-size:12px;
            background:rgba(124,92,255,0.18);
            border:1px solid rgba(124,92,255,0.6);
            cursor:pointer;

            /* ↓ 추가 */
            cursor: grab;
        }
        .tag-chip:active{
            cursor: grabbing;
        }

        /* 드래그 중 시각 효과 */
        .tag-chip.dragging{
            opacity: .5;
        }
        .tag-chip:hover{
            background:rgba(124,92,255,0.32);
        }

        /* 하단 버튼 */
        .form-actions{
            margin-top:10px;
            display:flex;
            justify-content:flex-end;
            gap:8px;
        }
        .primary-btn,
        .ghost-btn{
            min-width:90px;
            padding:7px 13px;
            border-radius:999px;
            border:0;
            font-size:13px;
            cursor:pointer;
        }
        .primary-btn{
            background:var(--accent);
            color:white;
        }
        .primary-btn:hover{
            background:#8a6dff;
        }
        .ghost-btn{
            background:transparent;
            color:var(--muted);
            border:1px solid var(--line);
        }
        .ghost-btn:hover{
            border-color:var(--accent);
            color:var(--text);
        }

        footer{
            width:100%;
            border-top:1px solid var(--line);
            padding:18px 0 22px;
            margin-top:auto;
            text-align:center;
            font-size:11px;
            color:var(--muted);
        }

        @media (max-width:800px){
            .edit-card{
                grid-template-columns:1fr;
            }
            .photo-section{
                border-right:none;
                border-bottom:1px solid var(--line);
                padding-right:0;
                padding-bottom:18px;
            }
        }
    </style>
</head>
<body>
<div class="page-shell">
    <header>
        <div class="header-inner">
            <a href="actor-detail.html" class="back-link">
                ← 프로필로 돌아가기
            </a>
            <div class="header-title">프로필 편집</div>
            <div style="width:70px;"></div>
        </div>
    </header>

    <main>
        <section class="edit-card">
            <!-- 왼쪽: 프로필 사진 -->
            <section class="photo-section">
                <img
                        id="profilePreview"
                        class="photo-preview"
                        src="videos/profile-placeholder.png"
                        alt="프로필 사진 미리보기" />

                <label class="pill-btn">
                    사진 선택
                    <input type="file" id="profileFileInput" accept="image/*">
                </label>

                <p class="photo-hint">
                    4:5 비율의 선명한 정면 사진을 권장해요.<br/>
                    (JPG, PNG, 최대 10MB)
                </p>
            </section>

            <!-- 오른쪽: 입력 폼 -->
            <section class="form-section">
                <form id="editProfileForm">
                    <!-- 이름 -->
                    <div class="field-group">
                        <label for="actorName" class="field-label">이름</label>
                        <input id="actorName" class="text-input" type="text" placeholder="예) 이병헌">
                    </div>

                    <!-- 생년월일 + 출생지 -->
                    <div class="two-col">
                        <div class="field-group">
                            <label class="field-label">출생일</label>

                            <div style="display:flex; gap:6px; align-items:center;">
                                <input
                                        id="birthYear"
                                        class="text-input"
                                        type="text"
                                        inputmode="numeric"
                                        maxlength="4"
                                        placeholder="YYYY"
                                        style="max-width:90px;"
                                >
                                <span>년</span>

                                <input
                                        id="birthMonth"
                                        class="text-input"
                                        type="text"
                                        inputmode="numeric"
                                        maxlength="2"
                                        placeholder="MM"
                                        style="max-width:70px;"
                                >
                                <span>월</span>

                                <input
                                        id="birthDay"
                                        class="text-input"
                                        type="text"
                                        inputmode="numeric"
                                        maxlength="2"
                                        placeholder="DD"
                                        style="max-width:70px;"
                                >
                                <span>일</span>
                            </div>

                            <div class="field-hint">YYYY-MM-DD 형식으로 입력해주세요.</div>

                            <!-- 실제로 서버에 보낼 hidden input -->
                            <input type="hidden" id="birthDate" name="birthDate">
                        </div>

                        <div class="field-group">
                            <label for="birthPlace" class="field-label">출생</label>
                            <input
                                    id="birthPlace"
                                    class="text-input"
                                    type="text"
                                    placeholder="예) 서울, 부산, 인천"
                            >
                            <div class="field-hint">시 단위로 입력해주세요.</div>
                        </div>

                    </div>

                    <!-- SNS 여러 개 -->
                    <div class="field-group">
                        <div class="field-label">SNS 링크</div>
                        <div class="field-hint">
                            인스타그램, 유튜브, 틱톡 등 여러 개를 등록할 수 있어요.
                        </div>

                        <div id="snsList" class="sns-list">
                            <!-- JS로 기본 1개 행 추가 -->
                        </div>

                        <button type="button" id="addSnsBtn" class="sns-add-btn">
                            + SNS 추가
                        </button>
                    </div>

                    <!-- PROFILE TAGS -->
                    <div class="field-group">
                        <div class="field-label">PROFILE TAGS</div>
                        <div class="field-hint">
                            배우의 이미지/강점을 나타내는 키워드를 입력해주세요. (예: #아역, #밝은이미지)
                        </div>

                        <div id="tagList" class="tag-list">
                            <!-- 태그 chip들 -->
                        </div>

                        <div class="tag-edit-row">
                            <input
                                    id="tagInput"
                                    class="text-input tag-input"
                                    type="text"
                                    placeholder="자유롭게 입력해주세요."
                            >
                            <button type="button" id="addTagBtn" class="tag-add-btn">추가</button>
                        </div>
                        <div class="field-hint">태그를 클릭하면 삭제됩니다.</div>
                    </div>

                    <!-- 하단 버튼 -->
                    <div class="form-actions">
                        <button type="button" class="ghost-btn" onclick="history.back()">취소</button>
                        <button type="submit" class="primary-btn">저장</button>
                    </div>
                </form>
            </section>
        </section>
    </main>

    <footer>
        © 2025 OnFilm · Indie Actor & Film Platform
    </footer>
</div>

<script>
    /* ===== 프로필 사진 미리보기 ===== */
    const profileFileInput = document.getElementById("profileFileInput");
    const profilePreview   = document.getElementById("profilePreview");

    profileFileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (ev) => {
            profilePreview.src = ev.target.result;
        };
        reader.readAsDataURL(file);
    });

    /* ===== SNS 행 추가/삭제 ===== */
    const snsList   = document.getElementById("snsList");
    const addSnsBtn = document.getElementById("addSnsBtn");

    function createSnsRow(initial = {type:"instagram", url:""}) {
        const row = document.createElement("div");
        row.className = "sns-row";

        const select = document.createElement("select");
        select.className = "select-input";
        select.innerHTML = `
      <option value="instagram">Instagram</option>
      <option value="youtube">YouTube</option>
      <option value="tiktok">TikTok</option>
      <option value="etc">기타</option>
    `;
        select.value = initial.type || "instagram";

        const input = document.createElement("input");
        input.className = "text-input";
        input.type = "url";
        input.placeholder = "www.example.com/...";
        input.value = initial.url || "";

        const removeBtn = document.createElement("button");
        removeBtn.type = "button";
        removeBtn.className = "sns-remove-btn";
        removeBtn.textContent = "✕";
        removeBtn.addEventListener("click", () => {
            snsList.removeChild(row);
            // 최소 1개는 남기고 싶다면 여기에서 체크 로직 추가 가능
            if (snsList.children.length === 0) {
                addSnsRow();
            }
        });

        row.appendChild(select);
        row.appendChild(input);
        row.appendChild(removeBtn);

        snsList.appendChild(row);
    }

    function addSnsRow() {
        createSnsRow({});
    }

    addSnsBtn.addEventListener("click", addSnsRow);

    // 기본 1개 행
    addSnsRow();


    // ===== TAG 드래그 앤 드롭 재정렬 =====
    let draggedChip = null;

    function handleTagDragStart(e) {
        draggedChip = e.target;
        draggedChip.classList.add("dragging");
    }

    function handleTagDragEnd(e) {
        if (draggedChip) {
            draggedChip.classList.remove("dragging");
        }
        draggedChip = null;
    }

    /* ===== TAGS: 추가 / 삭제 ===== */
    const tagListEl = document.getElementById("tagList");
    const tagInput  = document.getElementById("tagInput");
    const addTagBtn = document.getElementById("addTagBtn");

    function addTag(text) {
        const trimmed = text.trim();
        if (!trimmed) return;

        const label = trimmed.startsWith("#") ? trimmed : `#${trimmed}`;

        const chip = document.createElement("span");
        chip.className = "tag-chip";
        chip.textContent = label;

        // ✅ 드래그 가능하도록
        chip.draggable = true;
        chip.addEventListener("dragstart", handleTagDragStart);
        chip.addEventListener("dragend", handleTagDragEnd);

        // 클릭 시 삭제
        chip.addEventListener("click", () => {
            // (원한다면 dragging 중에는 삭제 안 하도록 방어 코드 넣어도 됨)
            if (chip.classList.contains("dragging")) return;
            tagListEl.removeChild(chip);
        });

        tagListEl.appendChild(chip);
    }

    addTagBtn.addEventListener("click", () => {
        addTag(tagInput.value);
        tagInput.value = "";
        tagInput.focus();
    });

    tagInput.addEventListener("keydown", (e) => {
        // ✅ 한글 입력 조합 중일 때는 Enter를 무시
        if (e.isComposing || e.keyCode === 229) {
            return;
        }

        if (e.key === "Enter") {
            e.preventDefault();
            addTag(tagInput.value);
            tagInput.value = "";
        }
    });

    // 태그 리스트 위에서 드래그되는 동안 위치 조정
    tagListEl.addEventListener("dragover", (e) => {
        e.preventDefault(); // drop 허용

        if (!draggedChip) return;

        const target = e.target.closest(".tag-chip");
        if (!target || target === draggedChip) return;

        const rect = target.getBoundingClientRect();
        const isAfter = e.clientX > rect.left + rect.width / 2;

        if (isAfter) {
            target.after(draggedChip);
        } else {
            target.before(draggedChip);
        }
    });
    // 예시 기본 태그들 (나중에 백엔드 데이터로 채우면 됨)
    ["#아역", "#밝은 이미지", "#광고 친화적"].forEach(addTag);

    // ===== 출생일(연/월/일) 자동 포커스 & hidden 값 채우기 =====
    const yearInput  = document.getElementById("birthYear");
    const monthInput = document.getElementById("birthMonth");
    const dayInput   = document.getElementById("birthDay");
    const birthDateHidden = document.getElementById("birthDate");

    // 숫자만 남기고, maxLength 채워지면 다음 input으로 이동
    function setupAutoMove(current, next) {
        if (!current) return;

        current.addEventListener("input", () => {
            // 숫자만 남기기
            current.value = current.value.replace(/\D/g, "");

            const max = current.getAttribute("maxlength");
            if (max && current.value.length >= parseInt(max, 10) && next) {
                next.focus();
            }
        });
    }

    setupAutoMove(yearInput, monthInput);
    setupAutoMove(monthInput, dayInput);
    // day는 마지막이라 next 없음

    /* ===== 폼 submit 핸들러 (현재는 콘솔 로그만) ===== */
    const form = document.getElementById("editProfileForm");

    // 폼 submit 시 YYYY-MM-DD로 합쳐서 hidden input에 넣기
    form.addEventListener("submit", (e) => {
        e.preventDefault();

        const y = (yearInput?.value || "").padStart(4, "0");
        const m = (monthInput?.value || "").padStart(2, "0");
        const d = (dayInput?.value || "").padStart(2, "0");

        // 간단 검증 (연/월/일이 비어있으면 그냥 경고)
        if (!yearInput.value || !monthInput.value || !dayInput.value) {
            alert("출생일을 모두 입력해 주세요.");
            return;
        }

        birthDateHidden.value = `${y}-${m}-${d}`;

        // 아래는 기존 payload 만드는 코드 그대로 두고,
        // birthDate는 hidden input에서 가져오면 됨
        const snsData = [];
        snsList.querySelectorAll(".sns-row").forEach(row => {
            const type = row.querySelector("select").value;
            const raw  = row.querySelector("input").value.trim();
            if (!raw) return;

            let finalUrl = raw;

            // 1) 이미 http:// 또는 https:// 로 시작하면 그대로 사용
            if (!/^https?:\/\//i.test(raw)) {

                // 2) 서비스 타입별로 기본 도메인 + 아이디 조합
                if (type === "instagram") {
                    // @붙여 쓴 경우 제거
                    const handle = raw.replace(/^@/, "");
                    finalUrl = `https://www.instagram.com/${handle}`;
                } else if (type === "youtube") {
                    // 여기서는 그냥 전체를 path 로 붙이는 예시
                    finalUrl = `https://www.youtube.com/${raw}`;
                } else if (type === "tiktok") {
                    const handle = raw.replace(/^@/, "");
                    finalUrl = `https://www.tiktok.com/@${handle}`;
                } else {
                    // 3) 기타 서비스면 그냥 https://만 앞에 붙여줌
                    finalUrl = `https://${raw}`;
                }
            }

            snsData.push({ type, url: finalUrl });
        });

        const tags = [];
        tagListEl.querySelectorAll(".tag-chip").forEach(chip => {
            tags.push(chip.textContent);
        });

        const payload = {
            name: document.getElementById("actorName").value.trim(),
            birthDate: birthDateHidden.value,  // ✅ 여기
            birthPlace: document.getElementById("birthPlace").value,
            snsList: snsData,
            tags: tags
        };

        console.log("프로필 저장 payload:", payload);
        alert("지금은 프론트 미리보기만 됩니다.\n콘솔에 payload가 출력됐어요.");
    });
</script>
</body>
</html>