<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ì˜í™” ì¬ìƒ</title>

  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif;
    }

    .player-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: black;
      overflow: hidden;
    }

    video {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      background: black;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ìƒë‹¨: ë’¤ë¡œê°€ê¸° + ì œëª©
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .top-left-info {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 30;
      transition: opacity .4s ease;
    }

    .top-left-info.hide-ui {
      opacity: 0;
      pointer-events: none;
    }

    .back-icon svg {
      width: 36px;
      height: 36px;
      stroke: white;
      cursor: pointer;
    }

    .video-title {
      font-size: 24px;
      font-weight: 700;
      color: white;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ì‹œê°„ í‘œì‹œ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .time-display {
      position: absolute;
      top: calc(100% - 150px);
      left: 20px;
      font-size: 15px;
      color: white;
      opacity: 1;
      transition: opacity .3s;
      z-index: 25;
      padding-left: 30px;
      padding-right: 30px;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       íƒ€ì„ë¼ì¸
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .timeline {
      position: absolute;
      bottom: 90px;
      left: 0;
      width: 100%;
      height: 10px;
      background: rgba(255,255,255,.25);
      cursor: pointer;
      z-index: 20;
      /*padding-left: 30px;*/
      /*padding-right: 30px;*/
    }

    .timeline-inner {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      border-radius: 999px;
    }

    .timeline-progress {
      position: absolute;
      inset: 0;
      width: 0%;
      height: 100%;
      background: #e50914; /* Netflix red */
    }

    .timeline.hide-ui {
      opacity: 0;
      transition: opacity .3s ease;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ì „ì²´
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .controls {
      position: absolute;
      bottom: 0;
      width: 100%;
      padding: 20px 0 16px;
      background: linear-gradient(to top, rgba(0,0,0,.6), transparent);
      color: white;
      opacity: 1;
      transition: opacity .3s;
      z-index: 25;
    }

    .bottom-bar {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: 0 20px;
    }

    .left-controls, .right-controls {
      display: flex;
      align-items: center;
      gap: 30px;
    }

    .right-controls {
      margin-left: auto;
      margin-right: 40px;
    }

    .icon {
      font-size: 40px;
      cursor: pointer;
      user-select: none;
      padding-left: 10px;
    }

    /* UI ìˆ¨ê¹€ ê³µí†µ */
    .hide-ui {
      opacity: 0;
      transition: opacity .4s;
    }

    /* ë°°ì† ë©”ë‰´ */
    .speed-wrapper {
      position: relative;             /* âœ… ì´ê±¸ ê¸°ì¤€ìœ¼ë¡œ ë©”ë‰´ ìœ„ì¹˜ê°€ ì¡í˜ */
      display: flex;
      align-items: center;
    }

    /* ë°°ì† ë©”ë‰´ */
    .speed-btn {
      font-size: 16px;
      cursor: pointer;
      user-select: none;
    }

    /* âœ… ì´ì œ ì•„ì´ì½˜ ë°”ë¡œ ìœ„, ê°€ìš´ë° ì •ë ¬ */
    .speed-menu {
      position: absolute;
      bottom: 32px;                   /* ë²„íŠ¼ ìœ„ë¡œ ëœ¨ê²Œ */
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.7);
      padding: 10px 14px;
      border-radius: 6px;
      font-size: 14px;
      display: none;
      z-index: 40;
    }

    .speed-option {
      padding: 6px 4px;
      cursor: pointer;
    }

    .speed-option:hover {
      color: #e50914;
    }

    /* ===== ì„¸ë¡œ ë³¼ë¥¨ íŒì—… UI ===== */
    .volume-popup {
      position: fixed;              /* í™”ë©´ ê¸°ì¤€ */
      width: 50px;
      height: 160px;
      background: rgba(20,20,20,0.92);
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;

      opacity: 0;
      pointer-events: none;
      transform: translateY(8px);   /* ì‚´ì§ ì•„ë˜ì—ì„œ ì‹œì‘ */
      transition:
              opacity .18s ease,
              transform .18s ease;
      z-index: 999;
    }

    .volume-popup.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);     /* ìœ„ë¡œ ì‚´ì§ ë– ì˜¤ë¥´ê²Œ */
    }

    /* ì„¸ë¡œ ìŠ¬ë¼ì´ë” */
    .volume-vertical {
      position: relative;
      z-index: 10;
      -webkit-appearance: none;
      appearance: none;
      width: 120px;
      height: 6px;
      background: transparent;
      transform: rotate(-90deg);
      transform-origin: center;
    }

    .volume-vertical::-webkit-slider-runnable-track {
      background: transparent;
    }

    .volume-vertical::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: white;
      border-radius: 50%;
      cursor: pointer;
    }

    /* íŠ¸ë™ (ë°°ê²½) */
    .volume-track {
      position: absolute;
      width: 6px;
      height: 120px;
      background: #555;
      border-radius: 4px;
      overflow: hidden;
    }

    /* íŒŒë€ ì±„ì›Œì§€ëŠ” ë¶€ë¶„ */
    .volume-fill {
      position: absolute;
      bottom: 0;              /* ì•„ë˜ì—ì„œë¶€í„° ì±„ì›Œì§ */
      width: 100%;
      height: 0%;             /* JSë¡œ ë†’ì´ë¥¼ ë°”ê¿”ì¤Œ */
      /*background: #00a3ff;*/ /* íŒŒë€ìƒ‰ */
      background: white;
      transition: height .1s linear;
    }

    /* ê°€ìš´ë° ì¬ìƒ/ì¼ì‹œì •ì§€ ì¸ë””ì¼€ì´í„° */
    .center-play-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9); /* ì‚´ì§ ì‘ê²Œ ì‹œì‘ */

      width: 90px;
      height: 90px;
      border-radius: 50%;

      /* â¬‡â¬‡â¬‡ í…Œë‘ë¦¬ ì—†ì• ê³  ë°˜íˆ¬ëª… ë™ê·¸ë¼ë¯¸ë§Œ */
      border: none;
      background: rgba(0, 0, 0, 0.45);
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.6);

      display: flex;
      align-items: center;
      justify-content: center;

      font-size: 38px;
      font-weight: 700;
      color: white;

      opacity: 0;
      pointer-events: none;
      transition:
              opacity .4s ease,
              transform .4s ease; /* ì„œì„œíˆ ë‚˜ì™”ë‹¤ê°€ ì‚¬ë¼ì§€ê²Œ */
      z-index: 50;
    }

    .center-play-indicator.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1); /* ì‚´ì§ ì»¤ì§€ë©´ì„œ ë“±ì¥ */
    }

    /* ì¢Œìš° 5ì´ˆ ì´ë™ ì¸ë””ì¼€ì´í„° ê³µí†µ */
    .skip-indicator {
      position: absolute;
      top: 50%;
      transform: translateY(-50%) scale(0.9);

      width: 80px;
      height: 80px;
      border-radius: 50%;

      /* â¬‡â¬‡â¬‡ í…Œë‘ë¦¬ ì—†ì• ê³  ë°˜íˆ¬ëª… ë™ê·¸ë¼ë¯¸ë§Œ */
      border: none;
      background: rgba(0, 0, 0, 0.45);
      box-shadow: 0 0 32px rgba(0, 0, 0, 0.6);

      display: flex;
      align-items: center;
      justify-content: center;

      font-size: 26px;
      font-weight: 700;
      color: white;

      opacity: 0;
      pointer-events: none;
      transition:
              opacity .4s ease,
              transform .4s ease;
      z-index: 50;
    }

    .skip-indicator.show {
      opacity: 1;
      transform: translateY(-50%) scale(1);
    }

    .skip-indicator-left {
      left: 25%;
    }

    .skip-indicator-right {
      right: 25%;
    }

    #playPause {
      width: 40px;              /* ë²„íŠ¼ ê°€ë¡œ í­ ê³ ì • */
      padding-left: 0;          /* ì™¼ìª½ ì—¬ë°± ì œê±°í•´ì„œ ë”± ê°€ìš´ë° */
      display: flex;            /* ê°€ìš´ë° ì •ë ¬ìš© */
      justify-content: center;
      align-items: center;
    }

  </style>

</head>
<body>

<div class="player-container">

  <!-- ë’¤ë¡œê°€ê¸° + ì œëª© -->
  <div class="top-left-info">
    <div id="backBtn" class="icon back-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <span class="video-title">ë°˜í’ˆ</span>
  </div>

  <!-- ì˜ìƒ -->
  <video id="video" src="videos/trailer.mp4"></video>

  <!-- ê°€ìš´ë° ì¬ìƒ/ì¼ì‹œì •ì§€ í‘œì‹œ -->
  <div id="centerIndicator" class="center-play-indicator">â–¶</div>

  <!-- ì™¼ìª½/ì˜¤ë¥¸ìª½ 5ì´ˆ ì´ë™ í‘œì‹œ -->
  <div id="skipLeft" class="skip-indicator skip-indicator-left">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none"
         viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
         width="28" height="28">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M21 16.811c0 .864-.933 1.406-1.683.977l-7.108-4.061a1.125 1.125 0 0 1 0-1.954l7.108-4.061A1.125 1.125 0 0 1 21 8.689v8.122ZM11.25 16.811c0 .864-.933 1.406-1.683.977l-7.108-4.061a1.125 1.125 0 0 1 0-1.954l7.108-4.061a1.125 1.125 0 0 1 1.683.977v8.122Z" />
    </svg>
    <span style="margin-left:6px;"></span>
  </div>

  <div id="skipRight" class="skip-indicator skip-indicator-right">
    <span style="margin-right:6px;"></span>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none"
         viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
         width="28" height="28">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M3 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061A1.125 1.125 0 0 1 3 16.811V8.69ZM12.75 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061a1.125 1.125 0 0 1-1.683-.977V8.69Z" />
    </svg>
  </div>

  <!-- ìƒë‹¨ ì‹œê°„ í‘œì‹œ -->
  <div class="time-display" id="timeDisplay">00:00 / 00:00</div>

  <!-- íƒ€ì„ë¼ì¸ -->
  <div class="timeline" id="timeline">
    <div class="timeline-inner">
      <div class="timeline-progress" id="timelineProgress"></div>
    </div>
  </div>

  <!-- ì»¨íŠ¸ë¡¤ -->
  <div class="controls" id="controls">
    <div class="bottom-bar">

      <!-- ì™¼ìª½ -->
      <div class="left-controls">
        <div id="playPause" class="icon">â–¶</div>
        <!-- âª ë’¤ë¡œ 10ì´ˆ -->
        <div id="back10" class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               width="32" height="32">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M21 16.811c0 .864-.933 1.406-1.683.977l-7.108-4.061a1.125 1.125 0 0 1 0-1.954l7.108-4.061A1.125 1.125 0 0 1 21 8.689v8.122ZM11.25 16.811c0 .864-.933 1.406-1.683.977l-7.108-4.061a1.125 1.125 0 0 1 0-1.954l7.108-4.061a1.125 1.125 0 0 1 1.683.977v8.122Z" />
          </svg>
        </div>

        <!-- â© ì•ìœ¼ë¡œ 10ì´ˆ -->
        <div id="forward10" class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               width="32" height="32">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M3 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061A1.125 1.125 0 0 1 3 16.811V8.69ZM12.75 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061a1.125 1.125 0 0 1-1.683-.977V8.69Z" />
          </svg>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ -->
      <div class="right-controls">
        <div id="volumeBtn" class="icon">
          <svg id="icon-sound-on" xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               width="32" height="32">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"/>
          </svg>

          <!-- ìŒì†Œê±° -->
          <svg id="icon-sound-off" xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               width="32" height="32" style="display:none;">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6
             4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354
             A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"/>
          </svg>
        </div>

        <!-- ì†ë„ ë²„íŠ¼  -->
        <div class="speed-wrapper">
          <div id="speedBtn" class="speed-btn">1x</div>

          <div class="speed-menu" id="speedMenu">
            <div class="speed-option" data-speed="1">1x</div>
            <div class="speed-option" data-speed="1.25">1.25x</div>
            <div class="speed-option" data-speed="1.5">1.5x</div>
            <div class="speed-option" data-speed="2">2x</div>
          </div>
        </div>

        <!-- ì„¸ë¡œ ë³¼ë¥¨ íŒì—… -->
        <div id="volumePopup" class="volume-popup">
          <div class="volume-track">
            <div id="volumeFill" class="volume-fill"></div>
          </div>
          <input type="range" id="volumeVertical" class="volume-vertical" min="0" max="1" step="0.02">
        </div>

        <div id="fullscreenBtn" class="icon">â›¶</div>
      </div>
    </div>
  </div>
</div>

<script>
  /* ìš”ì†Œ ì°¸ì¡° */
  const video = document.getElementById("video");
  const playPause = document.getElementById("playPause");
  const back10 = document.getElementById("back10");
  const forward10 = document.getElementById("forward10");
  const volumeBtn = document.getElementById("volumeBtn");
  const fullscreenBtn = document.getElementById("fullscreenBtn");
  const controls = document.getElementById("controls");
  const topLeftInfo = document.querySelector(".top-left-info");
  const timeDisplay = document.getElementById("timeDisplay");
  const speedBtn = document.getElementById("speedBtn");
  const speedMenu = document.getElementById("speedMenu");
  const timeline = document.getElementById("timeline");
  const timelineProgress = document.getElementById("timelineProgress");
  const backBtn = document.getElementById("backBtn");
  const centerIndicator = document.getElementById("centerIndicator");
  const skipLeft = document.getElementById("skipLeft");
  const skipRight = document.getElementById("skipRight");
  const titleEl = document.querySelector(".video-title");

  function toPublicMediaUrl(value) {
    const raw = String(value || "").trim();
    if (!raw) return "";
    if (raw.toLowerCase() === "pending") return "";
    if (/^https?:\/\//i.test(raw)) return raw;
    if (raw.startsWith("/files/")) return raw;
    if (raw.startsWith("files/")) return "/" + raw;
    return "/files/" + raw.replace(/^\/+/, "");
  }

  function initPlayerData() {
    let data = null;
    const raw = sessionStorage.getItem("onfilm.player");
    if (raw) {
      try { data = JSON.parse(raw); } catch (_) { data = null; }
    }

    const params = new URLSearchParams(window.location.search);
    const qsTitle = params.get("title");
    const qsSrc = params.get("src");

    const title = (data?.title || qsTitle || "").toString().trim();
    const src = (data?.movieUrl || qsSrc || "").toString().trim();

    if (title) {
      titleEl.textContent = title;
      document.title = title;
    }

    if (src) {
      video.src = toPublicMediaUrl(src);
    }
  }

  initPlayerData();

  /* ë’¤ë¡œê°€ê¸° */
  backBtn.onclick = () => history.back();

  /* ì‹œê°„ í¬ë§· */
  const fmt = (t) =>
          String(Math.floor(t / 60)).padStart(2, "0") +
          ":" +
          String(Math.floor(t % 60)).padStart(2, "0");

  /* ì˜ìƒ ë¡œë“œ & ìë™ ì¬ìƒ í”Œë˜ê·¸ */
  const allowSound = sessionStorage.getItem("allowSoundPlay");

  video.onloadedmetadata = () => {

    // ê¸°ì¡´ timeDisplay ì—…ë°ì´íŠ¸ ì½”ë“œ ìœ ì§€
    timeDisplay.textContent = `${fmt(video.currentTime)} / ${fmt(video.duration)}`;

    // ğŸ”¥ ë©”ì¸ì—ì„œ ì¬ìƒ ë²„íŠ¼ ëˆ„ë¥¸ ê²½ìš° â†’ ì†Œë¦¬ ON + ìë™ ì¬ìƒ
    if (allowSound === "true") {
      video.muted = false;
      video.volume = 1.0;     // ê¸°ë³¸ ë³¼ë¥¨
      video.play();

      playPause.textContent = "â¸"; // UIë„ ì¬ìƒ ìƒíƒœë¡œ ê°±ì‹ 

      // ğŸ”¥ ë³¼ë¥¨ UI ìƒíƒœ ê°±ì‹  ì¶”ê°€
      volumeVertical.value = video.volume;
      volumeFill.style.height = (video.volume * 100) + "%";

      // ìŒì†Œê±° ì•„ì´ì½˜ í‘œì‹œë„ ë§ì¶°ì£¼ê¸°
      iconSoundOn.style.display = "block";
      iconSoundOff.style.display = "none";
    }
  };

  /* ì˜ìƒ ì¬ìƒ ì¤‘ íƒ€ì„ë¼ì¸ / ì‹œê°„ ì—…ë°ì´íŠ¸ */
  video.ontimeupdate = () => {
    if (!isNaN(video.duration) && video.duration > 0) {
      timelineProgress.style.width =
              (video.currentTime / video.duration * 100) + "%";
    }
    timeDisplay.textContent =
            `${fmt(video.currentTime)} / ${fmt(video.duration)}`;
  };

  /* ì¬ìƒ / ì¼ì‹œì •ì§€ */
  function togglePlay() {
    if (video.paused) {
      video.play();
      playPause.textContent = "â¸";
      showCenterIndicator(true);   // ğŸ”¥ ì¬ìƒ ì•„ì´ì½˜
    } else {
      video.pause();
      playPause.textContent = "â–¶";
      showCenterIndicator(false);  // ğŸ”¥ ì¼ì‹œì •ì§€ ì•„ì´ì½˜
    }
  }
  playPause.onclick = togglePlay;
  video.onclick = togglePlay;

  /* í‚¤ë³´ë“œ */
  document.onkeydown = (e) => {
    if (e.code === "Space") {
      e.preventDefault();
      togglePlay();
    }

    if (e.key === "ArrowLeft") {
      e.preventDefault();
      video.currentTime = Math.max(0, video.currentTime - 5);
      showSkipIndicator("left");
    }

    if (e.key === "ArrowRight") {
      e.preventDefault();
      if (!isNaN(video.duration)) {
        video.currentTime = Math.min(video.duration, video.currentTime + 5);
      }
      showSkipIndicator("right");
    }

    /* ğŸ”¥ F í‚¤ â†’ ì „ì²´ í™”ë©´ í† ê¸€ */
    if (e.key === "f" || e.key === "F" || e.key === "ã„¹") {
      if (!document.fullscreenElement) {
        playerContainer.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    /* ğŸ”¥ M í‚¤ â†’ ìŒì†Œê±° í† ê¸€ */
    if (e.key === "m" || e.key === "M" || e.key === "ã…¡") {
      if (!video.muted) {
        // ìŒì†Œê±° ON
        lastVolume = video.volume;
        video.muted = true;
        video.volume = 0;
        volumeVertical.value = 0;
        volumeFill.style.height = "0%";
        iconSoundOn.style.display = "none";
        iconSoundOff.style.display = "block";
      } else {
        // ìŒì†Œê±° OFF
        video.muted = false;
        video.volume = lastVolume;
        volumeVertical.value = lastVolume;
        volumeFill.style.height = lastVolume * 100 + "%";
        iconSoundOn.style.display = "block";
        iconSoundOff.style.display = "none";
      }
    }
  };

  /* 10ì´ˆ ì´ë™ */
  back10.onclick = () => {
    video.currentTime = Math.max(0, video.currentTime - 10);
    showSkipIndicator("left");
  }
  forward10.onclick = () => {
    if (!isNaN(video.duration)) {
      video.currentTime = Math.min(video.duration, video.currentTime + 10);
      showSkipIndicator("right");
    }
  };

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë³¼ë¥¨ íŒì—… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const volumePopup = document.getElementById("volumePopup");
  const volumeVertical = document.getElementById("volumeVertical");

  /* ê¸°ë³¸ ë³¼ë¥¨ê°’ */
  video.volume = 0.7;
  volumeVertical.value = video.volume;

  /* íŒì—… ìœ„ì¹˜: ìŠ¤í”¼ì»¤ ì•„ì´ì½˜ â€œì •ì¤‘ì•™ ìœ„â€ */
  function updateVolumePopupPosition() {
    const rect = volumeBtn.getBoundingClientRect();
    const popupWidth = 50;
    const popupHeight = 160;

    const x = rect.left + rect.width / 2 - (popupWidth / 2);
    const y = rect.top - popupHeight - 8; // ì•„ì´ì½˜ ìœ„ë¡œ 8px ë„ìš°ê¸°

    volumePopup.style.left = x + "px";
    volumePopup.style.top = y + "px";
  }

  /* íŒì—… ì—´ê¸° */
  function openVolumePopup() {
    updateVolumePopupPosition();
    volumePopup.classList.add("show");
  }

  /* íŒì—… ë‹«ê¸° */
  function closeVolumePopup() {
    volumePopup.classList.remove("show");
  }

  /* hover ì§„ì…/ì´íƒˆ ìƒíƒœ ì²´í¬ìš© í”Œë˜ê·¸ */
  let overVolumeBtn = false;
  let overVolumePopup = false;
  let volumeHideTimer = null;

  function scheduleVolumeHide() {
    if (volumeHideTimer) clearTimeout(volumeHideTimer);
    volumeHideTimer = setTimeout(() => {
      if (!overVolumeBtn && !overVolumePopup) {
        closeVolumePopup();
      }
    }, 120); // ì§§ê²Œ ë”œë ˆì´ ì¤˜ì„œ ìì—°ìŠ¤ëŸ¬ìš´ ëŠë‚Œ
  }

  volumeBtn.addEventListener("mouseenter", () => {
    overVolumeBtn = true;
    openVolumePopup();
  });

  volumeBtn.addEventListener("mouseleave", () => {
    overVolumeBtn = false;
    scheduleVolumeHide();
  });

  volumePopup.addEventListener("mouseenter", () => {
    overVolumePopup = true;
  });

  volumePopup.addEventListener("mouseleave", () => {
    overVolumePopup = false;
    scheduleVolumeHide();
  });

  const iconSoundOn = document.getElementById("icon-sound-on");
  const iconSoundOff = document.getElementById("icon-sound-off");

  /* ì„¸ë¡œ ìŠ¬ë¼ì´ë”ë¡œ ë³¼ë¥¨ ì¡°ì ˆ */
  const volumeFill = document.getElementById("volumeFill");

  volumeVertical.addEventListener("input", () => {
    const v = Number(volumeVertical.value);
    video.volume = v;

    volumeFill.style.height = (v * 100) + "%";

    if (v === 0) {
      // ë³¼ë¥¨ 0 â†’ ìë™ ìŒì†Œê±°
      video.muted = true;
      // volumeBtn.textContent = "ğŸ”‡";
      iconSoundOn.style.display = "none";
      iconSoundOff.style.display = "block";
    } else {
      // ë³¼ë¥¨ì´ 0ë³´ë‹¤ í¬ë©´ ìë™ ìŒì†Œê±° í•´ì œ
      video.muted = false;
      // volumeBtn.textContent = "ğŸ”Š";
      iconSoundOn.style.display = "block";
      iconSoundOff.style.display = "none";
    }
  });

  /* ë³¼ë¥¨ ë“œë˜ê·¸ ì¡°ì ˆ */
  let draggingVolume = false;

  // ë§ˆìš°ìŠ¤ë¥¼ ëˆŒë €ì„ ë•Œ ë“œë˜ê·¸ ì‹œì‘
  volumeVertical.addEventListener("mousedown", (e) => {
    draggingVolume = true;
  });

  // ë§ˆìš°ìŠ¤ë¥¼ ë–¼ë©´ ë“œë˜ê·¸ ì¢…ë£Œ
  document.addEventListener("mouseup", () => {
    draggingVolume = false;
  });

  // ë“œë˜ê·¸ ì¤‘ ë§ˆìš°ìŠ¤ ì›€ì§ì¼ ë•Œ ê³„ì† ë³¼ë¥¨ ë°˜ì˜
  document.addEventListener("mousemove", (e) => {
    if (!draggingVolume) return;

    const rect = volumeVertical.getBoundingClientRect();

    // ìŠ¬ë¼ì´ë”ê°€ íšŒì „ë¼ ìˆì–´ì„œ Xì¶• ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•´ì•¼ í•¨
    const offsetX = e.clientX - rect.left;
    let percent = offsetX / rect.width;  // 0 ~ 1

    // ë²”ìœ„ ì œí•œ
    percent = Math.max(0, Math.min(1, percent));

    // ê°’ ë°˜ì˜
    volumeVertical.value = percent;
    video.volume = percent;

    // íŒŒë€ ì¤„ ì±„ìš°ê¸°
    volumeFill.style.height = (percent * 100) + "%";

    // ì•„ì´ì½˜ ìƒíƒœ ì—…ë°ì´íŠ¸
    if (percent === 0) {
      video.muted = true;
      // volumeBtn.textContent = "ğŸ”‡";
      iconSoundOn.style.display = "none";
      iconSoundOff.style.display = "block";
    } else {
      video.muted = false;
      // volumeBtn.textContent = "ğŸ”Š";
      iconSoundOn.style.display = "block";
      iconSoundOff.style.display = "none";
    }
  });



  /* ìŒì†Œê±° ë²„íŠ¼ (í´ë¦­) */
  let lastVolume = video.volume;

  volumeBtn.addEventListener("click", () => {
    if (!video.muted) {
      // ìŒì†Œê±° ON
      lastVolume = video.volume;     // í˜„ì¬ ë³¼ë¥¨ ì €ì¥
      video.muted = true;
      video.volume = 0;
      volumeVertical.value = 0;      // ìŠ¬ë¼ì´ë”ë„ ë°”ë‹¥ìœ¼ë¡œ
      volumeFill.style.height = "0%";
      // volumeBtn.textContent = "ğŸ”‡";
      iconSoundOn.style.display = "none";
      iconSoundOff.style.display = "block";
    }
    else {
      // ìŒì†Œê±° OFF
      video.muted = false;
      video.volume = lastVolume;     // ì´ì „ ë³¼ë¥¨ ë³µì›
      volumeVertical.value = lastVolume;
      volumeFill.style.height = lastVolume * 100 + "%";
      // volumeBtn.textContent = "ğŸ”Š";
      iconSoundOn.style.display = "block";
      iconSoundOff.style.display = "none";
    }
  });

  /* ì „ì²´ í™”ë©´ */
  const playerContainer = document.querySelector(".player-container");

  fullscreenBtn.onclick = () => {
    if (!document.fullscreenElement) {
      playerContainer.requestFullscreen();   // â† video ê°€ ì•„ë‹ˆë¼ playerContainer ì „ì²´!
    } else {
      document.exitFullscreen();
    }
  };

  /* ì „ì²´ í™”ë©´ ë³€ê²½ ì‹œ ë³¼ë¥¨ íŒì—… ìœ„ì¹˜ ì¬ê³„ì‚° */
  document.addEventListener("fullscreenchange", () => {
    showUI();

    if (volumePopup.classList.contains("show")) {
      updateVolumePopupPosition();
    }
  });

  /* ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìœ„ì¹˜ ì¬ì¡°ì • */
  window.addEventListener("resize", () => {
    if (volumePopup.classList.contains("show")) {
      updateVolumePopupPosition();
    }
  });

  /* íƒ€ì„ë¼ì¸ í´ë¦­ */
  timeline.onclick = (e) => {
    const r = timeline.getBoundingClientRect();
    const p = (e.clientX - r.left) / r.width;
    if (!isNaN(video.duration)) {
      video.currentTime = video.duration * Math.min(Math.max(p, 0), 1);
    }
  };

  /* ë°°ì† ë©”ë‰´ */
  speedBtn.onclick = () => {
    speedMenu.style.display =
            speedMenu.style.display === "block" ? "none" : "block";
  };

  document.querySelectorAll(".speed-option").forEach((o) => {
    o.onclick = () => {
      const rate = Number(o.dataset.speed);
      video.playbackRate = rate;
      speedBtn.textContent = rate + "x";
      speedMenu.style.display = "none";
    };
  });

  /* UI ìë™ ìˆ¨ê¹€ */
  let uiTimer = null;
  function showUI() {
    controls.classList.remove("hide-ui");
    timeDisplay.classList.remove("hide-ui");
    timeline.classList.remove("hide-ui");
    topLeftInfo.classList.remove("hide-ui");

    clearTimeout(uiTimer);

    uiTimer = setTimeout(() => {
      controls.classList.add("hide-ui");
      timeDisplay.classList.add("hide-ui");
      timeline.classList.add("hide-ui");
      topLeftInfo.classList.add("hide-ui");
    }, 2500);
  }

  document.onmousemove = showUI;
  document.ontouchstart = showUI;
  showUI();

  /* ëª¨ë°”ì¼ ë”ë¸”íƒ­ â†’ 10ì´ˆ ì´ë™ */
  let lastTap = 0;
  document.ontouchend = (e) => {
    const now = Date.now();
    if (now - lastTap < 300) {
      const x = e.changedTouches[0].clientX;
      if (x < window.innerWidth / 2) video.currentTime -= 10;
      else video.currentTime += 10;
    }
    lastTap = now;
  };

  // ê°€ìš´ë° ì¬ìƒ/ì¼ì‹œì •ì§€ ì¸ë””ì¼€ì´í„°
  let indicatorTimer = null;

  function showCenterIndicator(isPlaying) {
    if (!centerIndicator) return;

    // ê¸°ì¡´ íƒ€ì´ë¨¸ ìˆìœ¼ë©´ ì´ˆê¸°í™”
    if (indicatorTimer) clearTimeout(indicatorTimer);

    // ì•„ì´ì½˜ ëª¨ì–‘ ë³€ê²½
    centerIndicator.textContent = isPlaying ? "â–¶" : "â¸";

    // ë³´ì—¬ì£¼ê¸°
    centerIndicator.classList.add("show");

    // 0.4ì´ˆ ë’¤ì— ë‹¤ì‹œ ìˆ¨ê¸°ê¸°
    indicatorTimer = setTimeout(() => {
      centerIndicator.classList.remove("show");
    }, 400);
  }

  // ğŸ”¥ ì¢Œìš° 5ì´ˆ ì´ë™ ì¸ë””ì¼€ì´í„°
  let skipLeftTimer = null;
  let skipRightTimer = null;

  function showSkipIndicator(direction) {
    if (direction === "left") {
      if (!skipLeft) return;
      if (skipLeftTimer) clearTimeout(skipLeftTimer);

      skipLeft.classList.add("show");
      skipLeftTimer = setTimeout(() => {
        skipLeft.classList.remove("show");
      }, 400);
    } else if (direction === "right") {
      if (!skipRight) return;
      if (skipRightTimer) clearTimeout(skipRightTimer);

      skipRight.classList.add("show");
      skipRightTimer = setTimeout(() => {
        skipRight.classList.remove("show");
      }, 400);
    }
  }

</script>

</body>
</html>
